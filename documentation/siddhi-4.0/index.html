
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Stream Processing and Complex Event Processing Engine">
      
      
        <link rel="canonical" href="https://wso2.github.io/siddhi/documentation/siddhi-4.0/">
      
      
        <meta name="author" content="WSO2">
      
      
        <link rel="shortcut icon" href="../../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.1">
    
    
      
        <title>Siddhi Query Guide - WSO2 Siddhi</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-56ade86843.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-4d0d3f2fbf.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-f78e5cb881.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="https://wso2.github.io/siddhi" title="WSO2 Siddhi" class="md-logo md-header-nav__button">
            <img src="../../images/siddhi-logo-w.svg" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Documentation
                </span>
              
            
            Siddhi Query Guide
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
            


  


  <a href="https://github.com/wso2/siddhi" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      WSO2 Siddhi
    </div>
  </a>

          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../images/siddhi-logo-w.svg">
      </i>
    
    WSO2 Siddhi
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/wso2/siddhi" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      WSO2 Siddhi
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Welcome to WSO2 Siddhi" class="md-nav__link">
      Welcome to WSO2 Siddhi
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../siddhi-quckstart-4.0/" title="Quick Start Guide" class="md-nav__link">
      Quick Start Guide
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../user-guide/" title="User Guide" class="md-nav__link">
      User Guide
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Siddhi Query Guide
      </label>
    
    <a href="./" title="Siddhi Query Guide" class="md-nav__link md-nav__link--active">
      Siddhi Query Guide
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#siddhi-application" title="Siddhi Application" class="md-nav__link">
    Siddhi Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream" title="Stream" class="md-nav__link">
    Stream
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source" title="Source" class="md-nav__link">
    Source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sink" title="Sink" class="md-nav__link">
    Sink
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query" title="Query" class="md-nav__link">
    Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-projection" title="Query Projection" class="md-nav__link">
    Query Projection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function" title="Function" class="md-nav__link">
    Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter" title="Filter" class="md-nav__link">
    Filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#window" title="Window" class="md-nav__link">
    Window
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-function" title="Aggregate function" class="md-nav__link">
    Aggregate function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-by" title="Group By" class="md-nav__link">
    Group By
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" title="Having" class="md-nav__link">
    Having
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-stream" title="Join (Stream)" class="md-nav__link">
    Join (Stream)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern" title="Pattern" class="md-nav__link">
    Pattern
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence" title="Sequence" class="md-nav__link">
    Sequence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-rate-limiting" title="Output rate limiting" class="md-nav__link">
    Output rate limiting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partition" title="Partition" class="md-nav__link">
    Partition
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inner-stream" title="Inner Stream" class="md-nav__link">
    Inner Stream
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table" title="Table" class="md-nav__link">
    Table
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-table" title="Join (Table)" class="md-nav__link">
    Join (Table)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" title="Delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" title="Update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-or-insert" title="Update or Insert" class="md-nav__link">
    Update or Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" title="In" class="md-nav__link">
    In
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental-aggregation" title="Incremental Aggregation" class="md-nav__link">
    Incremental Aggregation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#join-aggregation" title="Join (Aggregation)" class="md-nav__link">
    Join (Aggregation)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defined-window" title="(Defined) Window" class="md-nav__link">
    (Defined) Window
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert_1" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-window" title="Join (Window)" class="md-nav__link">
    Join (Window)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from" title="From" class="md-nav__link">
    From
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trigger" title="Trigger" class="md-nav__link">
    Trigger
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script" title="Script" class="md-nav__link">
    Script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensions" title="Extensions" class="md-nav__link">
    Extensions
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      API Docs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        API Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/latest/" title="Latest (4.0.0-M93)" class="md-nav__link">
      Latest (4.0.0-M93)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M93/" title="4.0.0-M93" class="md-nav__link">
      4.0.0-M93
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M92/" title="4.0.0-M92" class="md-nav__link">
      4.0.0-M92
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M91/" title="4.0.0-M91" class="md-nav__link">
      4.0.0-M91
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M90/" title="4.0.0-M90" class="md-nav__link">
      4.0.0-M90
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M89/" title="4.0.0-M89" class="md-nav__link">
      4.0.0-M89
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M88/" title="4.0.0-M88" class="md-nav__link">
      4.0.0-M88
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M87/" title="4.0.0-M87" class="md-nav__link">
      4.0.0-M87
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M86/" title="4.0.0-M86" class="md-nav__link">
      4.0.0-M86
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M85/" title="4.0.0-M85" class="md-nav__link">
      4.0.0-M85
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M84/" title="4.0.0-M84" class="md-nav__link">
      4.0.0-M84
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M83/" title="4.0.0-M83" class="md-nav__link">
      4.0.0-M83
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M82/" title="4.0.0-M82" class="md-nav__link">
      4.0.0-M82
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M81/" title="4.0.0-M81" class="md-nav__link">
      4.0.0-M81
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M80/" title="4.0.0-M80" class="md-nav__link">
      4.0.0-M80
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/4.0.0-M79/" title="4.0.0-M79" class="md-nav__link">
      4.0.0-M79
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" title="Introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#siddhi-application" title="Siddhi Application" class="md-nav__link">
    Siddhi Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream" title="Stream" class="md-nav__link">
    Stream
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#source" title="Source" class="md-nav__link">
    Source
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sink" title="Sink" class="md-nav__link">
    Sink
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query" title="Query" class="md-nav__link">
    Query
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-projection" title="Query Projection" class="md-nav__link">
    Query Projection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#function" title="Function" class="md-nav__link">
    Function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter" title="Filter" class="md-nav__link">
    Filter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#window" title="Window" class="md-nav__link">
    Window
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregate-function" title="Aggregate function" class="md-nav__link">
    Aggregate function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-by" title="Group By" class="md-nav__link">
    Group By
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#having" title="Having" class="md-nav__link">
    Having
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-stream" title="Join (Stream)" class="md-nav__link">
    Join (Stream)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pattern" title="Pattern" class="md-nav__link">
    Pattern
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence" title="Sequence" class="md-nav__link">
    Sequence
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-rate-limiting" title="Output rate limiting" class="md-nav__link">
    Output rate limiting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partition" title="Partition" class="md-nav__link">
    Partition
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inner-stream" title="Inner Stream" class="md-nav__link">
    Inner Stream
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table" title="Table" class="md-nav__link">
    Table
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-table" title="Join (Table)" class="md-nav__link">
    Join (Table)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" title="Delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" title="Update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-or-insert" title="Update or Insert" class="md-nav__link">
    Update or Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in" title="In" class="md-nav__link">
    In
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental-aggregation" title="Incremental Aggregation" class="md-nav__link">
    Incremental Aggregation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#join-aggregation" title="Join (Aggregation)" class="md-nav__link">
    Join (Aggregation)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defined-window" title="(Defined) Window" class="md-nav__link">
    (Defined) Window
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert_1" title="Insert" class="md-nav__link">
    Insert
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#join-window" title="Join (Window)" class="md-nav__link">
    Join (Window)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#from" title="From" class="md-nav__link">
    From
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#trigger" title="Trigger" class="md-nav__link">
    Trigger
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#script" title="Script" class="md-nav__link">
    Script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensions" title="Extensions" class="md-nav__link">
    Extensions
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="siddhi-streaming-sql-guide-40">Siddhi Streaming SQL Guide 4.0<a class="headerlink" href="#siddhi-streaming-sql-guide-40" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Siddhi Streaming SQL is designed to process event streams in streaming manner, detect complex event occurrences, 
and notify them in real-time. </p>
<h2 id="siddhi-application">Siddhi Application<a class="headerlink" href="#siddhi-application" title="Permanent link">&para;</a></h2>
<p>Streaming processing and Complex Event Processing rules can be written is Siddhi Streaming SQL and they can be put 
together as <code>SiddhiApp</code> in one file. </p>
<p><strong>Purpose</strong></p>
<p>Each Siddhi Application is an isolated processing unit that let you deploy and 
execute queries independent of other SiddhiApps in the system.</p>
<p>The flowing diagram depicts how <strong>event flows</strong> within some of the key Siddhi Streaming SQL elements 
of the Siddhi Application.</p>
<p><img alt="Event Flow" src="../../images/event-flow.png?raw=true" title="Event Flow" /></p>
<p>Below table provides brief description of a few key elements in the Siddhi Streaming SQL Language.</p>
<table>
<thead>
<tr>
<th>Elements</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Stream</td>
<td>A logical series of events ordered in time with a uniquely identifiable name and set of defined typed attributes defining it's schema</td>
</tr>
<tr>
<td>Event</td>
<td>An event is associated with only one stream, and all events of that stream have an identical set of attributes assigned specific types (or the same schema). An event contains a timestamp and set of attribute values according to the schema.</td>
</tr>
<tr>
<td>Table</td>
<td>A structured representation of stored data with a defined schema. Stored data can be backed by <code>In-Memory</code>, <code>RDBMs</code>, <code>MongoDB</code>, etc to be accessed and manipulated at runtime.</td>
</tr>
<tr>
<td>Query</td>
<td>A logical construct that process events in streaming manner by combining existing streams and/or tables, and generates events to output stream or table. A query consumes one or more input streams and zero or one table, process those events in a streaming manner, publishes the output events to stream or tables for further processing or notifications.</td>
</tr>
<tr>
<td>Source</td>
<td>A contract that consumes data from external sources (such as <code>TCP</code>, <code>Kafka</code>, <code>HTTP</code>, etc), converts it's data format (such as <code>XML</code>, <code>JSON</code>, <code>binary</code>, etc) to Siddhi event, and passes that to a Stream for processing.</td>
</tr>
<tr>
<td>Sink</td>
<td>A contract that takes events arriving at a Stream, map them to a predefined data format (such as <code>XML</code>, <code>JSON</code>, <code>binary</code>, etc), and publish them to external endpoints (such as <code>E-mail</code>, <code>TCP</code>, <code>Kafka</code>, <code>HTTP</code>, etc).</td>
</tr>
<tr>
<td>Input Handler</td>
<td>A mechanism to programmatically inject events into Streams.</td>
</tr>
<tr>
<td>Stream/Query Callback</td>
<td>A mechanism to programmatically consumes output events from Streams and Queries.</td>
</tr>
<tr>
<td>Partition</td>
<td>A logical container that isolates processing of queries based on partition keys. Here separate instance of queries will be generated for each partition key to achieve isolation.</td>
</tr>
<tr>
<td>Inner Stream</td>
<td>A positionable stream that connects portioned queries within their partitions preserving isolation.</td>
</tr>
</tbody>
</table>
<p><strong>Grammar</strong></p>
<p>The element of Siddhi SQL can be composed together as a script in Siddhi App, Here each construct should be separated 
by a semicolon ( ; ). </p>
<div class="codehilite"><pre><span></span>&lt;siddhi app&gt;  : 
        &lt;app annotation&gt; * 
        ( &lt;stream definition&gt; | &lt;table definition&gt; | ... ) + 
        ( &lt;query&gt; | &lt;partition&gt; ) +
        ;
</pre></div>


<h2 id="stream">Stream<a class="headerlink" href="#stream" title="Permanent link">&para;</a></h2>
<p>Streams is a logical series of events ordered in time. It's schema is defined via the <strong>stream definition</strong>.
A stream definition contains a unique name and a set of attributes with specific types and uniquely identifiable names within the stream.
All events of a particular Stream will have the same schema (i.e. have the same attributes in the same order). </p>
<p><strong>Purpose</strong></p>
<p>By defining a schema it unifies common types of events together. This enables them to be processed at queries using their defined attributes in a streaming manner, and let sinks and sources to map events to/from various data formats.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for defining a new stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="o">&lt;</span><span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">);</span>
</pre></div>


<p>The following parameters are configured in a stream definition.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stream name</code></td>
<td>The name of the stream created. (as a convention <code>PascalCase</code> is used for stream name)</td>
</tr>
<tr>
<td><code>attribute name</code></td>
<td>The schema of an stream is defined by its attributes by uniquely identifiable attribute names (as a convention <code>camalCase</code> is used for attribute names)</td>
</tr>
<tr>
<td><code>attribute type</code></td>
<td>The type of each attribute defined in the schema. <br/> This can be <code>STRING</code>, <code>INT</code>, <code>LONG</code>, <code>DOUBLE</code>, <code>FLOAT</code>, <code>BOOL</code> or <code>OBJECT</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
</pre></div>


<p>The above creates a stream named <code>TempStream</code> with the following attributes.</p>
<ul>
<li><code>deviceID</code> of type <code>long</code></li>
<li><code>roomNo</code> of type <code>int</code> </li>
<li><code>temp</code> of type <code>double</code> </li>
</ul>
<h3 id="source">Source<a class="headerlink" href="#source" title="Permanent link">&para;</a></h3>
<p>Sources allow you to receive events via multiple transports and with various data formats into streams for processing.</p>
<p>Source let you define a mapping to convert the incoming event from its native data format (such as <code>JSON</code>, <code>TEXT</code>, <code>XML</code>, etc) 
to Siddhi Event, when customization to such mappings is not provided Siddhi assumes that the arriving event adhere to a 
predefined format based on the stream definition and the selected message format.</p>
<p><strong>Purpose</strong></p>
<p>Source provides a way to Siddhi consume events from external systems and map the events to adhere to the associated stream. </p>
<p><strong>Syntax</strong></p>
<p>To configure a stream to consume events via a source, add the source configuration to a stream definition by adding the <code>@source</code> annotation with the required parameter values. 
The source syntax is as follows:</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">source</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;source_type&#39;</span><span class="p">,</span> <span class="k">static</span><span class="p">.</span><span class="k">option</span><span class="p">.</span><span class="n">key1</span><span class="o">=</span><span class="s1">&#39;static_option_value1&#39;</span><span class="p">,</span> <span class="k">static</span><span class="p">.</span><span class="k">option</span><span class="p">.</span><span class="n">keyN</span><span class="o">=</span><span class="s1">&#39;static_option_valueN&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;map_type&#39;</span><span class="p">,</span> <span class="k">static</span><span class="p">.</span><span class="n">option_key1</span><span class="o">=</span><span class="s1">&#39;static_option_value1&#39;</span><span class="p">,</span> <span class="k">static</span><span class="p">.</span><span class="k">option</span><span class="p">.</span><span class="n">keyN</span><span class="o">=</span><span class="s1">&#39;static_option_valueN&#39;</span><span class="p">,</span>
        <span class="o">@</span><span class="n">attributes</span><span class="p">(</span> <span class="n">attributeN</span><span class="o">=</span><span class="s1">&#39;attribute_mapping_N&#39;</span><span class="p">,</span> <span class="n">attribute1</span><span class="o">=</span><span class="s1">&#39;attribute_mapping_1&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">stream_name</span> <span class="p">(</span><span class="n">attribute1</span> <span class="n">Type1</span><span class="p">,</span> <span class="n">attributeN</span> <span class="n">TypeN</span><span class="p">);</span>
</pre></div>


<p><strong>Source</strong></p>
<p>The <code>type</code> parameter of <code>@source</code> defines the source type that receives events. The other parameters to be configured 
depends on the source selected, some of those can also be optional values. 
For detailed information about the parameters refer the appropriate source documentation.</p>
<p>Some of the supports source types are:</p>
<ul>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-tcp/">TCP</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-kafka/">Kafka</a> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-http/">HTTP</a> <em>(Only works in WSO2 Stream Processor)</em> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-mqtt/">MQTT</a> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-rabbitmq/">RabbitMQ</a> </li>
<li>In-Memory</li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-file/">File</a> <em>(Only works in WSO2 Stream Processor)</em> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-jms/">JMS</a> <em>(Only works in WSO2 Stream Processor)</em>  </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-email/">E-mail</a>  <em>(Only works in WSO2 Stream Processor)</em> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-email/">WSO2-Event</a> <em>(Only works in WSO2 Stream Processor)</em> </li>
</ul>
<p><strong>Source Mapper</strong></p>
<p>Each <code>@source</code> will have a mapping denoted by <code>@map</code> that converts the incoming message format to Siddhi event.</p>
<p>The <code>type</code> parameter of <code>@map</code> defines the map type that's responsible of mapping the data. The other parameters to be 
configured depends on the mapper selected, some of those can also be optional values. 
For detailed information about the parameters refer the appropriate mapper documentation.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When <code>@map</code> is not provided <code>@map(type='passThrough')</code> will be used as default. This can be used when source consumes Siddhi events and when it does not need any mappings.</p>
</div>
<p><strong>Map Attributes</strong></p>
<p><code>@attributes</code> is an optional parameter of <code>@map</code> to define custom mapping. When <code>@attributes</code> is not provided each mapper
assumes that the incoming events will be adhere to it's own expected default data format. By defining <code>@attributes</code> you 
can configure mappers to extract data from the incoming message selectively and assign then to attributes. </p>
<p>There are two ways you can configure <code>@attributes</code>. </p>
<ol>
<li>Defining attributes as keys and mapping content as value in the following format: <br/>
<code>@attributes( attributeN='mapping_N', attribute1='mapping_1')</code> </li>
<li>Defining all attributes' mapping content in the same order as how the attributes are defined in stream definition: <br/>
<code>@attributes( 'mapping_1', 'mapping_N')</code> </li>
</ol>
<p>Some of the supports source mappings are:</p>
<ul>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-json/">JSON</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-xml/">XML</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-binary/">Binary</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-text/">Text</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-keyvalue/">Key-Value</a></li>
</ul>
<p><strong>Example</strong></p>
<p>The following query receives events via the <code>HTTP</code> source on <code>JSON</code> data format, and passes them in the <code>InputStream</code> stream for processing. 
Here the HTTP source is configured to receive events on all network interfaces on port <code>8080</code> on the context <code>foo</code>, and 
its protected by basic authentication.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">source</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">receiver</span><span class="p">.</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://0.0.0.0:8080/foo&#39;</span><span class="p">,</span> <span class="k">is</span><span class="p">.</span><span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> 
  <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">InputStream</span> <span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">age</span> <span class="nb">int</span><span class="p">,</span> <span class="n">country</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<h3 id="sink">Sink<a class="headerlink" href="#sink" title="Permanent link">&para;</a></h3>
<p>Sinks allow you to publish events from the streams via multiple transports to external endpoints with various data formats.</p>
<p>Sink let you define a mapping to convert the Siddhi event to appropriate output data format (such as <code>JSON</code>, <code>TEXT</code>, <code>XML</code>, etc), 
when customization to such mappings is not provided Siddhi converts events to its default format based on the stream definition and 
the selected data format and publish the events.</p>
<p><strong>Purpose</strong></p>
<p>Sink provides a way to publish Siddhi events to external systems in their preferred data format. </p>
<p><strong>Syntax</strong></p>
<p>To configure a stream to publish events via a Sink, add the sink configuration to a stream definition by adding the <code>@sink</code> 
annotation with the required parameter values. The sink syntax is as follows:</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;sink_type&#39;</span><span class="p">,</span> <span class="n">static_option_key1</span><span class="o">=</span><span class="s1">&#39;static_option_value1&#39;</span><span class="p">,</span> <span class="n">dynamic_option_key1</span><span class="o">=</span><span class="s1">&#39;{{dynamic_option_value1}}&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;map_type&#39;</span><span class="p">,</span> <span class="n">static_option_key1</span><span class="o">=</span><span class="s1">&#39;static_option_value1&#39;</span><span class="p">,</span> <span class="n">dynamic_option_key1</span><span class="o">=</span><span class="s1">&#39;{{dynamic_option_value1}}&#39;</span><span class="p">,</span>
        <span class="o">@</span><span class="n">payload</span><span class="p">(</span><span class="s1">&#39;payload_mapping&#39;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">stream_name</span> <span class="p">(</span><span class="n">attribute1</span> <span class="n">Type1</span><span class="p">,</span> <span class="n">attributeN</span> <span class="n">TypeN</span><span class="p">);</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Dynamic Properties</p>
<p>The Sink and Sink mapper properties that are categorised as <code>dynamic</code> have the ability to absorb attributes values 
from their associated Streams. This can be done by using the attribute names in double curly braces as <code>{{...}}</code> when configuring the property value. </p>
<p>Some valid dynamic properties values are: </p>
<ul>
<li><code>'{{attribute1}}'</code></li>
<li><code>'This is {{attribute1}}'</code> </li>
<li><code>{{attribute1}} &gt; {{attributeN}}</code>  </li>
</ul>
<p>Here the attribute names in the double curly braces will be replaced with event values during execution. </p>
</div>
<p><strong>Sink</strong></p>
<p>The <code>type</code> parameter of <code>@sink</code> defines the sink type that publishes the events. The other parameters to be configured 
depends on the sink selected, some of those can also be optional and some can be dynamic values. 
For detailed information about the parameters refer the appropriate sink documentation.</p>
<p>Some of the supports sink types are:</p>
<ul>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-tcp/">TCP</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-kafka/">Kafka</a> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-email/">E-mail</a>  <em>(Only works in WSO2 Stream Processor)</em> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-mqtt/">MQTT</a> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-rabbitmq/">RabbitMQ</a> </li>
<li>In-Memory</li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-file/">File</a> <em>(Only works in WSO2 Stream Processor)</em> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-http/">HTTP</a> <em>(Only works in WSO2 Stream Processor)</em> </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-jms/">JMS</a> <em>(Only works in WSO2 Stream Processor)</em>  </li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-io-email/">WSO2-Event</a> <em>(Only works in WSO2 Stream Processor)</em> </li>
</ul>
<p><strong>Sink Mapper</strong></p>
<p>Each <code>@sink</code> will have a mapping denoted by <code>@map</code> that converts the Siddhi event to an outgoing message format.</p>
<p>The <code>type</code> parameter of <code>@map</code> defines the map type that's responsible of mapping the event. The other parameters to be configured depends on the mapper selected, some of those can also be optional or dynamic values. 
For detailed information about the parameters refer the appropriate mapper documentation.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When <code>@map</code> is not provided <code>@map(type='passThrough')</code> will be used as default. This can be used when Sink can publish Siddhi events and when it does not need any mappings.</p>
</div>
<p><strong>Map Payload</strong></p>
<p><code>@payload</code> is an optional parameter of <code>@map</code> to define a custom mapping. When <code>@payload</code> is not provided each mapper
maps the outgoing events to it's own default data format. By defining <code>@payload</code> you 
can configure mappers to produce the output payload as of your choice using dynamic properties by selectively assigning 
the attributes on your preferred format. </p>
<p>There are two ways you can configure <code>@payload</code>. </p>
<ol>
<li>Some mappers such as <code>XML</code>, <code>JSON</code>, and <code>Test</code> accepts only one output payload using the following format: <br/>
<code>@payload( 'This is a test message from {{user}}.' )</code> </li>
<li>Some mappers such <code>key-value</code> accepts series of mapping values defined as: <br/>
<code>@payload( key1='mapping_1', key2='user : {{user}}')</code> </li>
</ol>
<p>Some of the supports sink mappings are:</p>
<ul>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-json/">JSON</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-xml/">XML</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-binary/">Binary</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-text/">Text</a></li>
<li><a target="_blank" href="https://wso2-extensions.github.io/siddhi-map-keyvalue/">Key-Value</a></li>
</ul>
<p><strong>Example</strong></p>
<p>The following query publishes events from <code>OutputStream</code> via the <code>HTTP</code> Sink. Here the events are mapped to default <code>JSON</code> payloads and sent to <code>http://localhost:8005/endpoint</code>
 using <code>POST</code> method, <code>Accept</code> header, and basic authentication having <code>admin</code> as both the username and the password.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">publisher</span><span class="p">.</span><span class="n">url</span><span class="o">=</span><span class="s1">&#39;http://localhost:8005/endpoint&#39;</span><span class="p">,</span> <span class="k">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s1">&#39;Accept-Date:20/02/2017&#39;</span><span class="p">,</span> 
  <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span><span class="o">=</span><span class="s1">&#39;true&#39;</span><span class="p">,</span>
  <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">OutputStream</span> <span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">ang</span> <span class="nb">int</span><span class="p">,</span> <span class="n">country</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<h2 id="query">Query<a class="headerlink" href="#query" title="Permanent link">&para;</a></h2>
<p>Each Siddhi query can consume one/more streams and zero/one table, process the events in streaming manner and generate a
 output event to a stream or performs CRUD operation to a table.</p>
<p><strong>Purpose</strong></p>
<p>Query enables you to perform Complex Event Processing and Stream Processing operations by processing incoming events one by one in the arrival order. </p>
<p><strong>Syntax</strong></p>
<p>All queries contain an input and output section, some also contain a projection section. A simple query with all three sections is as follows.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">/</span><span class="k">table</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Example</strong></p>
<p>Following simple query in the Siddhi App consumes events from defined <code>TempStream</code> stream and output the room temperature and room number to <code>RoomTempStream</code> stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span> 
<span class="k">select</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">temp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">RoomTempStream</span><span class="p">;</span>
</pre></div>


<div class="admonition tip">
<p class="admonition-title">Inferred Stream</p>
<p>Here the <code>RoomTempStream</code> is an inferred Stream, i.e. <code>RoomTempStream</code> can be used as any other defined stream 
without explicitly defining its Stream Definition and the definition of the <code>RoomTempStream</code> will be inferred from the 
first query that produces the Stream.  </p>
</div>
<h3 id="query-projection">Query Projection<a class="headerlink" href="#query-projection" title="Permanent link">&para;</a></h3>
<p>Siddhi queries supports the following for query projections.</p>
<table style="width:100%">
    <tr>
        <th>Action</th>
        <th>Description</th>
    </tr>
    <tr>
        <td>Selecting required objects for projection</td>
        <td>This involves selecting only some of the attributes from the input stream to be inserted into an output stream.
            <br><br>
            E.g., The following query selects only the `roomNo` and `temp` attributes from the `TempStream` stream.
            <pre style="align:left">from TempStream<br>select roomNo, temp<br>insert into RoomTempStream;</pre>
        </td>
    </tr>
    <tr>
        <td>Selecting all attributes for projection</td>
        <td>Selecting all the attributes in an input stream to be inserted into an output stream. This can be done by using asterisk ( * ) or by omitting the `select` statement.
            <br><br>
            E.g., Use one of the following queries to select all the attributes in the `NewTempStream` stream.
            <pre>from TempStream<br>select *<br>insert into NewTempStream;</pre>
            or
            <pre>from TempStream<br>insert into NewTempStream;</pre>
        </td>
    </tr>
    <tr>
        <td>Renaming attributes</td>
        <td>This selects attributes from the input streams and inserting them into the output stream with different names.
            <br><br>
            E.g., The following query renames `roomNo` to `roomNumber` and `temp` to `temperature`.
            <pre>from TempStream <br>select roomNo as roomNumber, temp as temperature<br>insert into RoomTempStream;</pre>
        </td>
    </tr>
    <tr>
        <td>Introducing the constant value</td>
        <td>This adds constant values by assigning it to an attribute using `as`.
            <br></br>
            E.g., Using 'C' as the constant value for `scale` attribute. 
            <pre>from TempStream<br>select roomNo, temp, 'C' as scale<br>insert into RoomTempStream;</pre>
        </td>
    </tr>
    <tr>
        <td>Using mathematical and logical expressions</td>
        <td>This uses attributes with mathematical and logical expressions in the precedence order given below, and assign them to the output attribute using `as`.
            <br><br>
            <b>Operator precedence</b><br>
            <table style="width:100%">
                <tr>
                    <th>Operator</th>
                    <th>Distribution</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td>
                        ()
                    </td>
                    <td>
                        Scope
                    </td>
                    <td>
                        <pre>(cost + tax) * 0.05</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                         IS NULL
                    </td>
                    <td>
                        Null check
                    </td>
                    <td>
                        <pre>deviceID is null</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        NOT
                    </td>
                    <td>
                        Logical NOT
                    </td>
                    <td>
                        <pre>not (price > 10)</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                         *   /   %  
                    </td>
                    <td>
                        Multiplication, division, modulo
                    </td>
                    <td>
                        <pre>temp * 9/5 + 32</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        +   -  
                    </td>
                    <td>
                        Addition, substraction
                    </td>
                    <td>
                        <pre>temp * 9/5 - 32</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        <   <=   >   >=
                    </td>
                    <td>
                        Comparators: less-than, greater-than-equal, greater-than, less-than-equal
                    </td>
                    <td>
                        <pre>totalCost >= price * quantity</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        ==   !=  
                    </td>
                    <td>
                        Comparisons: equal, not equal
                    </td>
                    <td>
                        <pre>totalCost !=  price * quantity</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        IN
                    </td>
                    <td>
                        Contains in table
                    </td>
                    <td>
                        <pre>roomNo in ServerRoomsTable</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        AND
                    </td>
                    <td>
                        Logical AND
                    </td>
                    <td>
                        <pre>temp < 40 and (humidity < 40 or humidity >= 60)</pre>
                    </td>
                </tr>
                <tr>
                    <td>
                        OR
                    </td>
                    <td>
                        Logical OR
                    </td>
                    <td>
                        <pre>temp < 40 or (humidity < 40 and humidity >= 60)</pre>
                    </td>
                </tr>
            </table>
            E.g., Converting Celsius to Fahrenheit and identifying rooms with room number between 10 and 15 as server rooms.
            <pre>from TempStream<br>select roomNo, temp * 9/5 + 32 as temp, 'F' as scale, roomNo > 10 and roomNo < 15 as isServerRoom<br>insert into RoomTempStream;</pre>       
    </tr>

</table>

<h3 id="function">Function<a class="headerlink" href="#function" title="Permanent link">&para;</a></h3>
<p>A function consumes zero, one or more parameters and always produces a result value. It can be used any location where
 an attribute can be used. </p>
<p><strong>Purpose</strong></p>
<p>Functions encapsulates complex making the Siddhi application simple and easy to understand. </p>
<p><strong>Function Parameters</strong></p>
<p>Functions parameters can be attributes, constant values, results of other functions, results of mathematical or logical expressions or time parameters. 
Function parameters depending on the function being called.</p>
<p>Time is a special parameter that can we defined using the integer time value followed by its unit as <code>&lt;int&gt; &lt;unit&gt;</code>. 
Following are the supported unit types. Upon execution time returns the value in the scale of milliseconds as a long value. </p>
<table style="width:100%">
    <tr>
        <th>
            Unit  
        </th>
        <th>
            Syntax
        </th>
    </tr>
    <tr>
        <td>
            Year
        </td>
        <td>
            year | years
        </td>
    </tr>
    <tr>
        <td>
            Month
        </td>
        <td>
            month | months
        </td>
    </tr>
    <tr>
        <td>
            Week
        </td>
        <td>
            week | weeks
        </td>
    </tr>
    <tr>
        <td>
            Day
        </td>
        <td>
            day | days
        </td>
    </tr>
    <tr>
        <td>
            Hour
        </td>
        <td>
           hour | hours
        </td>
    </tr>
    <tr>
        <td>
           Minutes
        </td>
        <td>
           minute | minutes | min
        </td>
    </tr>
    <tr>
        <td>
           Seconds
        </td>
        <td>
           second | seconds | sec
        </td>
    </tr>
    <tr>
        <td>
           Milliseconds
        </td>
        <td>
           millisecond | milliseconds
        </td>
    </tr>
</table>

<p>E.g. Passing 1 hour and 25 minutes to <code>test()</code> function.</p>
<pre>test(1 hour 25 min)</pre>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Functions, mathematical expressions, and logical expressions can be used in a nested manner.</p>
</div>
<p>Following are some inbuilt functions shipped with Siddhi, for more functions refer execution <a target="_blank" href="https://wso2.github.io/siddhi/extensions/">extensions</a>.</p>
<ul>
<li>eventTimestamp</li>
<li>log</li>
<li>UUID</li>
<li>default</li>
<li>cast</li>
<li>convert</li>
<li>ifThenElse</li>
<li>minimum</li>
<li>maximum</li>
<li>coalesce</li>
<li>instanceOfBoolean</li>
<li>instanceOfDouble</li>
<li>instanceOfFloat</li>
<li>instanceOfInteger</li>
<li>instanceOfLong</li>
<li>instanceOfString</li>
</ul>
<p><strong>Example</strong></p>
<p>The following configuration converts the <code>roomNo</code> to <code>string</code> and adds a <code>messageID</code> to each event using the <code>convert</code> and <code>UUID</code> functions.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span>
<span class="k">select</span> <span class="k">convert</span><span class="p">(</span><span class="n">roomNo</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">UUID</span><span class="p">()</span> <span class="k">as</span> <span class="n">messageID</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">RoomTempStream</span><span class="p">;</span>
</pre></div>


<h3 id="filter">Filter<a class="headerlink" href="#filter" title="Permanent link">&para;</a></h3>
<p>Filters are included in queries to filter information from input streams based on a specified condition.</p>
<p><strong>Purpose</strong></p>
<p>A filter allows you to separate events that match a specific condition as the output, or for further processing.</p>
<p><strong>Syntax</strong></p>
<p>Filter conditions should be defined in square brackets next to the input stream name as shown below.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Example</strong></p>
<p>The following query filters all server rooms within the range of 100 and 210, and having temperature greater than 40 degrees 
from the <code>TempStream</code> stream, and inserts the results into the <code>HighTempStream</code> stream.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="p">[(</span><span class="n">roomNo</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="k">and</span> <span class="n">roomNo</span> <span class="o">&lt;</span> <span class="mi">210</span><span class="p">)</span> <span class="k">and</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">]</span>
<span class="k">select</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">temp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">HighTempStream</span><span class="p">;</span>
</pre></div>


<h3 id="window">Window<a class="headerlink" href="#window" title="Permanent link">&para;</a></h3>
<p>Windows allow you to capture a subset of events based on a specific criterion from an input stream for calculation. 
Each input stream can only have maximum of one window.</p>
<p><strong>Purpose</strong></p>
<p>To create subsets of events within a stream based on time duration, number of events, etc for processing. 
Window can operate on sliding or tumbling (batch) manner.</p>
<p><strong>Syntax</strong></p>
<p>The <code>#window</code> prefix should be inserted next to the relevant stream in order to use a window.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="o">&lt;</span><span class="n">event</span> <span class="k">type</span><span class="o">&gt;</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Filter condition can be applied both before and/or after the window</p>
</div>
<p><strong>Example</strong></p>
<p>If you want to identify the maximum temperature out of last 10 events, you need to define a <code>length</code> window of 10 events.
 This window operates as a sliding mode where the following 3 subsets will be calculated when a list of 12 events are received in a sequential order.</p>
<table>
<thead>
<tr>
<th>Subset</th>
<th>Event Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1-10</td>
</tr>
<tr>
<td>2</td>
<td>2-11</td>
</tr>
<tr>
<td>3</td>
<td>3-12</td>
</tr>
</tbody>
</table>
<p>The following query finds the maximum temperature out of <strong>last 10 events</strong> from the <code>TempStream</code> stream, 
and inserts the results into the <code>MaxTempStream</code> stream.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">maxTemp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">MaxTempStream</span><span class="p">;</span>
</pre></div>


<p>If you define the maximum temperature reading out of every 10 events, you need to define a <code>lengthBatch</code> window of 10 events.
 Where this window operates as a batch/tumbling mode where the following 3 subsets will be calculated when a list of 30 events are received in a sequential order.</p>
<table>
<thead>
<tr>
<th>Subset</th>
<th>Event Range</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1-10</td>
</tr>
<tr>
<td>2</td>
<td>11-20</td>
</tr>
<tr>
<td>3</td>
<td>21-30</td>
</tr>
</tbody>
</table>
<p>The following query finds the maximum temperature out of <strong>every 10 events</strong> from the <code>TempStream</code> stream, 
and inserts the results into the <code>MaxTempStream</code> stream.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">lengthBatch</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">maxTemp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">MaxTempStream</span><span class="p">;</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Similar operations can also be done time with <code>time</code> window and <code>timeBatch</code> window and for others. 
Code segments such as <code>#window.time(10 min)</code> will consider events in last 10 minutes in a sliding manner and <code>#window.timeBatch(2 min)</code> will consider events every 2 minutes in a tumbling manner. </p>
</div>
<p>Following are some inbuilt windows shipped with Siddhi, for more window types refer execution <a target="_blank" href="https://wso2.github.io/siddhi/extensions/">extensions</a>. </p>
<ul>
<li>time</li>
<li>timeBatch</li>
<li>length</li>
<li>lengthBatch</li>
<li>sort</li>
<li>frequent</li>
<li>lossyFrequent</li>
<li>cron</li>
<li>externalTime</li>
<li>externalTimeBatch</li>
</ul>
<p><strong>Output event type</strong><a id="output-event-types" class='anchor' aria-hidden='true'></a> </p>
<p>Projection of the query depends on the output event types such as, <code>current</code> and <code>expired</code> event types.
 By default all queries produce <code>current</code> events and only queries with windows produce <code>expired</code> events 
 when events expire from the window.
 By controlling the event types outputted you will be able to manipulate the output of the query. </p>
<p><strong>Note!</strong> Controlling the output event types will not alter the execution within the query and will not affect the correctness of the query execution.  </p>
<p>The following keywords can be used with the output stream to manipulate output. </p>
<table>
<thead>
<tr>
<th>Output event types</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>current events</code></td>
<td>Output events when incoming events arrives to the query. </br> This is the default functionality of no output event types is specified.</td>
</tr>
<tr>
<td><code>expired events</code></td>
<td>Output events when events expires from the window.</td>
</tr>
<tr>
<td><code>all events</code></td>
<td>Output events when incoming events arrives to the query and </br> when events expires from the window.</td>
</tr>
</tbody>
</table>
<p>The output event type keyword can be used between <code>insert</code> and <code>into</code> as given in the following example.</p>
<p><strong>Example</strong></p>
<p>Delay all events in a stream by 1 minute.  </p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">1</span> <span class="k">min</span><span class="p">)</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="n">expired</span> <span class="n">events</span> <span class="k">into</span> <span class="n">DelayedTempStream</span>
</pre></div>


<h3 id="aggregate-function">Aggregate function<a class="headerlink" href="#aggregate-function" title="Permanent link">&para;</a></h3>
<p>Aggregate functions perform aggregate calculations in the query. 
When a window is defined the aggregation will get restricted within that window and if no window is provided they will aggregate from the start of the Siddhi application.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="k">aggregate</span> <span class="k">function</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p><strong>Aggregate Parameters</strong></p>
<p>Aggregate parameters can be attributes, constant values, results of other functions or aggregates, results of mathematical or logical expressions or time parameters. 
Aggregate parameters depending on the Aggregation being called.</p>
<p><strong>Example</strong></p>
<p>The following query calculates the average of <code>temp</code> attribute of <code>TempStream</code> stream for the last 
10 minutes and emit it as `avgTemp``.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span> <span class="k">min</span><span class="p">)</span>
<span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">avgTemp</span><span class="p">,</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">deviceID</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AvgTempStream</span><span class="p">;</span>
</pre></div>


<p>Following are some inbuilt aggregation functions shipped with Siddhi, for more aggregation functions refer execution <a target="_blank" href="https://wso2.github.io/siddhi/extensions/">extensions</a>. </p>
<ul>
<li>avg</li>
<li>sum</li>
<li>max</li>
<li>min</li>
<li>count</li>
<li>distinctCount</li>
<li>maxForever</li>
<li>minForever</li>
<li>stdDev</li>
</ul>
<h3 id="group-by">Group By<a class="headerlink" href="#group-by" title="Permanent link">&para;</a></h3>
<p>Group By allows you to group the aggregate based on specified attributes.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(...)</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="k">aggregate</span> <span class="k">function</span><span class="o">&gt;</span><span class="p">(</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">attribute1</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">group</span> <span class="k">by</span> <span class="o">&lt;</span><span class="n">attribute1</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p><strong>Example</strong>
The following query calculates the average temperature per <code>roomNo</code> and <code>deviceID</code> combination 
for sliding 10 minutes time from the <code>TempStream</code> stream.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span> <span class="k">min</span><span class="p">)</span>
<span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">avgTemp</span><span class="p">,</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">deviceID</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">roomNo</span><span class="p">,</span> <span class="n">deviceID</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AvgTempStream</span><span class="p">;</span>
</pre></div>


<h3 id="having">Having<a class="headerlink" href="#having" title="Permanent link">&para;</a></h3>
<p>Having allows you to filter events after processing the <code>select</code> statement,
 this will be helpful to filter the aggregation output.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(</span> <span class="p">...</span> <span class="p">)</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="k">aggregate</span> <span class="k">function</span><span class="o">&gt;</span><span class="p">(</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">attribute1</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">group</span> <span class="k">by</span> <span class="o">&lt;</span><span class="n">attribute1</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute2</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">...</span>
<span class="k">having</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p><strong>Example</strong></p>
<p>The following query calculates the average temperature per room for the last 10 minutes, and alerts if it exceeds 30 degrees.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">10</span> <span class="k">min</span><span class="p">)</span>
<span class="k">select</span> <span class="k">avg</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="n">avgTemp</span><span class="p">,</span> <span class="n">roomNo</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">roomNo</span>
<span class="k">having</span> <span class="n">avgTemp</span> <span class="o">&gt;</span> <span class="mi">30</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<h3 id="join-stream">Join (Stream)<a class="headerlink" href="#join-stream" title="Permanent link">&para;</a></h3>
<p><strong>Purpose</strong></p>
<p>Join let you get a combined results from two streams in real time based on a condition. </p>
<p>As streams are stateless to join two streams they need to be connected to a window such that 
there will be a pool of events that can be used for joining. Join also accepts a condition to 
join appropriate events from each streams. </p>
<p>During the joining process each incoming event of each stream is matched against all the events in the other 
stream's window on the given condition, and the output events are generated for all the matching event pairs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Join can also be performed with <a href="#join-table">sored data</a>, <a href="#join-aggregation">aggregation</a> or externally <a href="#join-window">defined windows</a>.</p>
</div>
<p><strong>Syntax</strong></p>
<p>The syntax for a join is as follows:</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span> <span class="err">{</span><span class="n">unidirectional</span><span class="err">}</span> <span class="err">{</span><span class="k">as</span> <span class="o">&lt;</span><span class="n">reference</span><span class="o">&gt;</span><span class="err">}</span>
         <span class="k">join</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;#</span><span class="n">window</span><span class="p">.</span><span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span>  <span class="p">...</span> <span class="p">)</span> <span class="err">{</span><span class="n">unidirectional</span><span class="err">}</span> <span class="err">{</span><span class="k">as</span> <span class="o">&lt;</span><span class="n">reference</span><span class="o">&gt;</span><span class="err">}</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="k">join</span> <span class="n">condition</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<p>Here the <code>&lt;join condition&gt;</code> let you match the attributes from both the streams. </p>
<p><strong>unidirectional join operation</strong></p>
<p>By default events arriving on either stream can trigger the joining process, but if you want to control the 
join execution you can add the <code>unidirectional</code> keyword next to a stream in the join definition as depicted in the 
syntax to only enable that stream to trigger the join operation. Here events arriving on other stream only updates its 
 window and it will not trigger the join operation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We cannot use <code>unidirectional</code> keyword for both the input streams (as that's equal to the default behaviour, which 
is not using the unidirectional keyword at all).</p>
</div>
<p><strong>Example</strong></p>
<p>Assuming that the temperature of regulators are updated every minute. 
Following is a Siddhi App the controls the temperature regulators if they are not already 'on' for all the rooms that 
have a room temperature greater than 30 degrees.  </p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">isOn</span> <span class="n">bool</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span><span class="p">[</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">.</span><span class="mi">0</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">1</span> <span class="k">min</span><span class="p">)</span> <span class="k">as</span> <span class="n">T</span>
  <span class="k">join</span> <span class="n">RegulatorStream</span><span class="p">[</span><span class="n">isOn</span> <span class="o">==</span> <span class="k">false</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">R</span>
  <span class="k">on</span> <span class="n">T</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">R</span><span class="p">.</span><span class="n">roomNo</span>
<span class="k">select</span> <span class="n">T</span><span class="p">.</span><span class="n">roomNo</span><span class="p">,</span> <span class="n">R</span><span class="p">.</span><span class="n">deviceID</span><span class="p">,</span> <span class="s1">&#39;start&#39;</span> <span class="k">as</span> <span class="n">action</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">RegulatorActionStream</span><span class="p">;</span>
</pre></div>


<p><strong>Supported join types</strong> </p>
<p>Following are the supported operations of join clause.</p>
<ul>
<li>
<p><strong>Inner join (join)</strong> </p>
<p>The default behaviour of join, use <code>join</code> as the keyword to join both the streams. The output is generated only if there is 
a matching event in both the streams.</p>
</li>
<li>
<p><strong>Left outer join</strong> </p>
<p>Left outer join let you join two streams to be merged based on a condition. Use <code>left outer join</code> as the keyword to join both the streams.
Here it returns all the events of left stream even if there are no matching events in the right stream by 
having the right stream attribute values as nulls.</p>
<p><strong>Example</strong></p>
<p>The following query generates output events for all events from <code>StockStream</code> stream regardless of a matching 
symbol being present in the <code>TwitterStream</code> stream.</p>
<p><pre>
from StockStream#window.time(1 min) as S
  left outer join TwitterStream#window.length(1) as T
  on S.symbol== T.symbol
select S.symbol as symbol, T.tweet, S.price
insert into outputStream ;    </pre></p>
</li>
<li>
<p><strong>Right outer join</strong> </p>
<p>This is similar to left outer join. Use <code>Right outer join</code> as the keyword to join both the streams.
It returns all the events of the right stream even if there are no matching events in the left stream. </p>
</li>
<li>
<p><strong>Full outer join</strong> </p>
<p>The full outer join combines the results of left outer join and right outer join. Use <code>full outer join</code> as the keyword to join both the streams.
Here, output event are generated for each incoming event even if there are no matching events in the other stream.</p>
<p><strong>Example</strong></p>
<p>The following query generates output events for all the incoming events of each stream regardless of whether there is a 
match for the <code>symbol</code> in the other stream or not.</p>
<p><pre>
from StockStream#window.time(1 min) as S
  full outer join TwitterStream#window.length(1) as T
  on S.symbol== T.symbol
select S.symbol as symbol, T.tweet, S.price
insert into outputStream ;    </pre></p>
</li>
</ul>
<h3 id="pattern">Pattern<a class="headerlink" href="#pattern" title="Permanent link">&para;</a></h3>
<p>Patterns is a state machine implementation that allow you to detect event occurrence patterns over time. 
This can correlate events within a single stream or between multiple streams. </p>
<p><strong>Purpose</strong> </p>
<p>Let you detect a specified event occurrence pattern over a time period. </p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for a pattern query:</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="p">(</span><span class="k">every</span><span class="p">)</span><span class="o">?</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">-&gt;</span> 
    <span class="p">(</span><span class="k">every</span><span class="p">)</span><span class="o">?</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">-&gt;</span> 
    <span class="p">...</span> 
    <span class="p">(</span><span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">gap</span><span class="o">&gt;</span><span class="p">)</span><span class="o">?</span>     
<span class="k">select</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<table>
<thead>
<tr>
<th>Items</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-&gt;</code></td>
<td>This represent followed by, i.e. After a event matching the first condition the next event matching the next condition arriving sometime after the first event (not necessarily need to be immediately after the previous event event)</td>
</tr>
<tr>
<td><code>&lt;event reference&gt;</code></td>
<td>Let you add a reference to the the matching event such that it can be accessed later for further processing.</td>
</tr>
<tr>
<td><code>(within &lt;time gap&gt;)?</code></td>
<td><code>within</code> clause is optional, It defines the the duration within all the matching events should occur</td>
</tr>
<tr>
<td><code>every</code></td>
<td><code>every</code> is an optional keyword. This defines weather the event matching should be triggered for every event arrival for the specified stream with the matching condition. <br/> When this keyword is not used the matching happens only ones.</td>
</tr>
</tbody>
</table>
<p>Siddhi also support pattern matching with counting events and matching events in a logical order such as (<code>and</code>, <code>or</code>, and <code>not</code>). Those are discussed in detail later.</p>
<p><strong>Example</strong></p>
<p>The following query sends an alert if the temperature of a room increases by 5 degrees within 10 min.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="k">every</span><span class="p">(</span> <span class="n">e1</span><span class="o">=</span><span class="n">TempStream</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNo</span> <span class="k">and</span> <span class="p">(</span><span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">temp</span> <span class="p">]</span>
    <span class="n">within</span> <span class="mi">10</span> <span class="k">min</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="p">,</span> <span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="k">as</span> <span class="n">initialTemp</span><span class="p">,</span> <span class="n">e2</span><span class="p">.</span><span class="n">temp</span> <span class="k">as</span> <span class="n">finalTemp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>Here for each events in <code>TempStream</code>, the matching process begins (because <code>every</code> is used with <code>e1=TempStream</code>), 
and if there is another event arrives within 10 minutes, having <code>temp</code> attribute greater then or equal to <code>e1.temp + 5</code> 
of the event e1, an output is generated via the <code>AlertStream</code>.</p>
<p><strong>Counting Pattern</strong></p>
<p>Counting pattern allows matching multiple events that may have been received for the same matching condition.
The number of events matched per condition can be limited via condition postfixes.</p>
<p><strong>Syntax</strong></p>
<p>Each matching condition can contain a collection of events with the minimum and maximum number of events to be matched as bellow. </p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="p">(</span><span class="k">every</span><span class="p">)</span><span class="o">?</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">(</span><span class="o">&lt;&lt;</span><span class="k">min</span> <span class="k">count</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="k">max</span> <span class="k">count</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="o">?</span> <span class="o">-&gt;</span>  
    <span class="p">...</span> 
    <span class="p">(</span><span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">gap</span><span class="o">&gt;</span><span class="p">)</span><span class="o">?</span>     
<span class="k">select</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">([</span><span class="n">event</span> <span class="k">index</span><span class="p">])</span><span class="o">?</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<table>
<thead>
<tr>
<th>Postfix</th>
<th>Description</th>
<th>Example</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;n1:n2&gt;</code></td>
<td>This matches <code>n1</code> to <code>n2</code> events (including <code>n1</code> and excluding <code>n2</code>).</td>
<td><code>1:4</code> matches 1 to 4 events.</td>
<td></td>
</tr>
<tr>
<td><code>&lt;n:&gt;</code></td>
<td>This matches <code>n</code> or more events (including <code>n</code>).</td>
<td><code>&lt;2:&gt;</code> matches 2 or more events.</td>
<td></td>
</tr>
<tr>
<td><code>&lt;:n&gt;</code></td>
<td>This matches up to <code>n</code> events (excluding <code>n</code>).</td>
<td><code>&lt;:5&gt;</code> matches up to 5 events.</td>
<td></td>
</tr>
<tr>
<td><code>&lt;n&gt;</code></td>
<td>This matches exactly <code>n</code> events.</td>
<td><code>&lt;5&gt;</code> matches exactly 5 events.</td>
<td></td>
</tr>
</tbody>
</table>
<p>Specific occurrences of the event in a collection can be retrieved by using event index along with its reference,
 square brackets can be used to indicate the event index where <code>1</code> can be used as the index of the first event and <code>last</code> can be used as the index
 for the <code>last</code> available event in the event collection. If you provided a index grater then the last event index
 the system returns <code>null</code>. Some valid examples are bellow.</p>
<ul>
<li><code>e1[3]</code> refers to the 3rd event.</li>
<li><code>e1[last]</code> refers to the last event.</li>
<li><code>e1[last - 1]</code> refers to the event before the last event.</li>
</ul>
<p><strong>Example</strong></p>
<p>The following Siddhi App calculates temperature difference between two regulator events.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tempSet</span> <span class="n">double</span><span class="p">,</span> <span class="n">isOn</span> <span class="n">bool</span><span class="p">);</span>

<span class="k">from</span> <span class="k">every</span><span class="p">(</span> <span class="n">e1</span><span class="o">=</span><span class="n">RegulatorStream</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="o">==</span><span class="n">roomNo</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span><span class="o">&gt;</span> <span class="o">-&gt;</span> <span class="n">e3</span><span class="o">=</span><span class="n">RegulatorStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="o">==</span><span class="n">roomNo</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="p">,</span> <span class="n">e2</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">temp</span> <span class="o">-</span> <span class="n">e2</span><span class="p">[</span><span class="k">last</span><span class="p">].</span><span class="n">temp</span> <span class="k">as</span> <span class="n">tempDiff</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">TempDiffStream</span><span class="p">;</span>
</pre></div>


<p><strong>Logical Patterns</strong></p>
<p>Logical pattern matches events that arrive in temporal order and correlates them with logical relationships such as <code>and</code>, 
<code>or</code> and <code>not</code>. </p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="p">(</span><span class="k">every</span><span class="p">)</span><span class="o">?</span> <span class="p">(</span><span class="k">not</span><span class="p">)</span><span class="o">?</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span> 
          <span class="p">((</span><span class="k">and</span><span class="o">|</span><span class="k">or</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">])</span><span class="o">?</span> <span class="p">(</span><span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">gap</span><span class="o">&gt;</span><span class="p">)</span><span class="o">?</span> <span class="o">-&gt;</span>  
    <span class="p">...</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">([</span><span class="n">event</span> <span class="k">index</span><span class="p">])</span><span class="o">?</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<p>Keywords such as <code>and</code>, <code>or</code>, or <code>not</code> can used to illustrate the logical relationship.</p>
<table>
<thead>
<tr>
<th>Key Word</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>and</code></td>
<td>This allows both conditions of <code>and</code> to be matched by two events in any order.</td>
</tr>
<tr>
<td><code>or</code></td>
<td>The state will succeed if either condition of <code>or</code> is satisfied. Here the event reference of the other condition will be <code>null</code>.</td>
</tr>
<tr>
<td><code>not &lt;condition1&gt; and &lt;condition2&gt;</code></td>
<td>When <code>not</code> with <code>and</code> is present, it let you identify an event matching <code>&lt;condition2&gt;</code> before any event match the <code>&lt;condition1&gt;</code>.</td>
</tr>
<tr>
<td><code>not &lt;condition&gt; for &lt;time period&gt;</code></td>
<td>When <code>not</code> is present with <code>for</code>, it let you identify no event occurring that matches <code>&lt;condition1&gt;</code> for the given time  <code>&lt;condition1&gt;</code>.  is used to define a time period. E.g.<code>from not TemperatureStream[temp &gt; 60] for 5 sec</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>Following Siddhi App, sends <code>stop</code> control action to regulator, when the key is removed from the hotel room. </p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStateChangeStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tempSet</span> <span class="n">double</span><span class="p">,</span> <span class="n">action</span> <span class="n">string</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RoomKeyStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">action</span> <span class="n">string</span><span class="p">);</span>


<span class="k">from</span> <span class="k">every</span><span class="p">(</span> <span class="n">e1</span><span class="o">=</span><span class="n">RegulatorStateChangeStream</span><span class="p">[</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;on&#39;</span> <span class="p">]</span> <span class="p">)</span> <span class="o">-&gt;</span> 
      <span class="n">e2</span><span class="o">=</span><span class="n">RoomKeyStream</span><span class="p">[</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNo</span> <span class="k">and</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;removed&#39;</span> <span class="p">]</span> <span class="k">or</span> <span class="n">e3</span><span class="o">=</span><span class="n">RegulatorStateChangeStream</span><span class="p">[</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNo</span> <span class="k">and</span> <span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span><span class="p">,</span> <span class="n">ifThenElse</span><span class="p">(</span> <span class="n">e2</span> <span class="k">is</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;stop&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">action</span>
<span class="k">having</span> <span class="n">action</span> <span class="o">!=</span> <span class="s1">&#39;none&#39;</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">RegulatorActionStream</span><span class="p">;</span>
</pre></div>


<p>Following Siddhi App, alerts if we have switch off the regulator before temperature reaches 12 degrees.  </p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStateChangeStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tempSet</span> <span class="n">double</span><span class="p">,</span> <span class="n">action</span> <span class="n">string</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">e1</span><span class="o">=</span><span class="n">RegulatorStateChangeStream</span><span class="p">[</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="k">not</span> <span class="n">TempStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNo</span> <span class="k">and</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">]</span> <span class="k">and</span> <span class="n">e2</span><span class="o">=</span><span class="n">RegulatorStateChangeStream</span><span class="p">[</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span> <span class="k">as</span> <span class="n">roomNo</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p>Following Siddhi App, alerts if the temperature did not reduce 12 degrees within 5 minutes of switching on the regulator.  </p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStateChangeStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tempSet</span> <span class="n">double</span><span class="p">,</span> <span class="n">action</span> <span class="n">string</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">e1</span><span class="o">=</span><span class="n">RegulatorStateChangeStream</span><span class="p">[</span><span class="n">action</span> <span class="o">==</span> <span class="s1">&#39;start&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="k">not</span> <span class="n">TempStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNo</span> <span class="k">and</span> <span class="n">temp</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">]</span> <span class="k">for</span> <span class="s1">&#39;5 min&#39;</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">roomNo</span> <span class="k">as</span> <span class="n">roomNo</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<h3 id="sequence">Sequence<a class="headerlink" href="#sequence" title="Permanent link">&para;</a></h3>
<p>Sequence is a state machine implementation that allow you to detect sequence of event occurrences over time. 
Here <strong>all matching events need to arrive conservatively</strong> to match the sequence condition,
 and there cannot be any non matching events arrived withing a matching sequence of events.
This can correlate events within a single stream or between multiple streams. </p>
<p><strong>Purpose</strong> </p>
<p>Let you detect a specified event sequence over a time period. </p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for a sequence query:</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="p">(</span><span class="k">every</span><span class="p">)</span><span class="o">?</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">],</span> 
    <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">],</span> 
    <span class="p">...</span> 
    <span class="p">(</span><span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">gap</span><span class="o">&gt;</span><span class="p">)</span><span class="o">?</span>     
<span class="k">select</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<table>
<thead>
<tr>
<th>Items</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>,</code></td>
<td>This represent immediate next event, i.e. After a event matching the first condition the immediate next conservative event must match the next condition.</td>
</tr>
<tr>
<td><code>&lt;event reference&gt;</code></td>
<td>Let you add a reference to the the matching event such that it can be accessed later for further processing.</td>
</tr>
<tr>
<td><code>(within &lt;time gap&gt;)?</code></td>
<td><code>within</code> clause is optional, It defines the the duration within all the matching events should occur</td>
</tr>
<tr>
<td><code>every</code></td>
<td><code>every</code> is an optional keyword. This defines weather the event matching should be triggered for every event arrival for the specified stream with the matching condition. <br/> When this keyword is not used the matching happens only ones.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>The following query sends an alert if there is more than 1 degree increase in the temperature between two consecutive temperature events.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="k">every</span> <span class="n">e1</span><span class="o">=</span><span class="n">TempStream</span><span class="p">,</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">temp</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="k">as</span> <span class="n">initialTemp</span><span class="p">,</span> <span class="n">e2</span><span class="p">.</span><span class="n">temp</span> <span class="k">as</span> <span class="n">finalTemp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">AlertStream</span><span class="p">;</span>
</pre></div>


<p><strong>Counting Sequence</strong></p>
<p>Counting Sequence allows matching multiple events for the same matching condition.
The number of events matched per condition can be limited via condition postfixes as <strong>Counting Patterns</strong> or by using the 
<code>*</code>, <code>+</code> and <code>?</code> operators.</p>
<p>The matching events can also be retrieved using event indexes like in  <strong>Counting Patterns</strong></p>
<p><strong>Syntax</strong></p>
<p>Each matching condition in a sequence can contain a collection of events as mentioned bellow. </p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="p">(</span><span class="k">every</span><span class="p">)</span><span class="o">?</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">](</span><span class="o">+|*|?</span><span class="p">)</span><span class="o">?</span><span class="p">,</span> 
    <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">](</span><span class="o">+|*|?</span><span class="p">)</span><span class="o">?</span><span class="p">,</span> 
    <span class="p">...</span> 
    <span class="p">(</span><span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">gap</span><span class="o">&gt;</span><span class="p">)</span><span class="o">?</span>     
<span class="k">select</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<table>
<thead>
<tr>
<th>Postfix symbol</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>+</code></td>
<td>Its optional, that machines <strong>one or more</strong> event occurrences of the for the given condition.</td>
</tr>
<tr>
<td><code>*</code></td>
<td>Its optional, that machines <strong>zero or more</strong> event occurrences of the for the given condition.</td>
</tr>
<tr>
<td><code>?</code></td>
<td>Its optional, that machines <strong>zero or one</strong> event occurrences of the for the given condition.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>The following Siddhi App identifies temperature peeks.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="k">every</span> <span class="n">e1</span><span class="o">=</span><span class="n">TempStream</span><span class="p">,</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="o">&lt;=</span> <span class="n">temp</span><span class="p">]</span><span class="o">+</span><span class="p">,</span> <span class="n">e3</span><span class="o">=</span><span class="n">TempStream</span><span class="p">[</span><span class="n">e2</span><span class="p">[</span><span class="k">last</span><span class="p">].</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">]</span>
<span class="k">select</span> <span class="n">e1</span><span class="p">.</span><span class="n">temp</span> <span class="k">as</span> <span class="n">initialTemp</span><span class="p">,</span> <span class="n">e2</span><span class="p">[</span><span class="k">last</span><span class="p">].</span><span class="n">temp</span> <span class="k">as</span> <span class="n">peakTemp</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">PeekTempStream</span><span class="p">;</span>
</pre></div>


<p><strong>Logical Sequence</strong></p>
<p>Logical sequence identifies logical relationships using <code>and</code>, <code>or</code> and <code>not</code> on consecutively arriving events.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="p">(</span><span class="k">every</span><span class="p">)</span><span class="o">?</span> <span class="p">(</span><span class="k">not</span><span class="p">)</span><span class="o">?</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span> 
          <span class="p">((</span><span class="k">and</span><span class="o">|</span><span class="k">or</span><span class="p">)</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;=&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">filter</span> <span class="n">condition</span><span class="o">&gt;</span><span class="p">])</span><span class="o">?</span> <span class="p">(</span><span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">gap</span><span class="o">&gt;</span><span class="p">)</span><span class="o">?</span><span class="p">,</span> 
    <span class="p">...</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">event</span> <span class="n">reference</span><span class="o">&gt;</span><span class="p">([</span><span class="n">event</span> <span class="k">index</span><span class="p">])</span><span class="o">?</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<p>Keywords such as <code>and</code>, <code>or</code>, or <code>not</code> can used to illustrate the logical relationship same as in <strong>Logical Patterns</strong>. </p>
<p><strong>Example</strong></p>
<p>Following Siddhi App notifies the state when a regulator event is immediately followed by both the temperature and humidity events. </p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">HumidStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">humid</span> <span class="n">double</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RegulatorStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">isOn</span> <span class="n">bool</span><span class="p">);</span>

<span class="k">from</span> <span class="k">every</span> <span class="n">e1</span><span class="o">=</span><span class="n">RegulatorStream</span><span class="p">,</span> <span class="n">e2</span><span class="o">=</span><span class="n">TempStream</span> <span class="k">and</span> <span class="n">e3</span><span class="o">=</span><span class="n">HumidStream</span>
<span class="k">select</span> <span class="n">e2</span><span class="p">.</span><span class="n">temp</span><span class="p">,</span> <span class="n">e3</span><span class="p">.</span><span class="n">humid</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">StateNotificationStream</span><span class="p">;</span>
</pre></div>


<h3 id="output-rate-limiting">Output rate limiting<a class="headerlink" href="#output-rate-limiting" title="Permanent link">&para;</a></h3>
<p>Output rate limiting allows queries to emit events periodically based on the condition specified.</p>
<p><strong>Purpose</strong></p>
<p>This allows you to limit the output to avoid overloading following executions and to remove unnecessary information.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax of an output rate limiting configuration.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> <span class="p">...</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">output</span> <span class="o">&lt;</span><span class="n">rate</span> <span class="n">limiting</span> <span class="n">configuration</span><span class="o">&gt;</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<p>Three type of output rate limiting configuration are available, such as </p>
<table>
<thead>
<tr>
<th>Rate limiting configuration</th>
<th>Syntax</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Based on time</td>
<td><code>&lt;output event&gt; every &lt;time interval&gt;</code></td>
<td>Output <code>&lt;output event&gt;</code> for every given <code>&lt;time interval&gt;</code> time interval.</td>
</tr>
<tr>
<td>Based on number of events</td>
<td><code>&lt;output event&gt; every &lt;event interval&gt; events</code></td>
<td>Output <code>&lt;output event&gt;</code> for every <code>&lt;event interval&gt;</code> number of events.</td>
</tr>
<tr>
<td>Snapshot based output</td>
<td><code>snapshot every &lt;time interval&gt;</code></td>
<td>Output all events in the window (or the last event if no window is defined in the query) for every given <code>&lt;time interval&gt;</code> time interval.</td>
</tr>
</tbody>
</table>
<p>Here the <code>&lt;output event&gt;</code> specifies which event(s) should be emitted as the output of the query. 
The possible values are as follows:
<em> <code>first</code> : Only the first event processed by the query in the specified time interval/sliding window is emitted.
</em> <code>last</code> : Only the last event processed by the query in the specified time interval/sliding window is emitted.
* <code>all</code> : All the events processed by the query in the specified time interval/sliding window are emitted. <strong>When no <code>&lt;output event&gt;</code> is defined <code>all</code> will be used as default.</strong></p>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Emitting events based on number of events</p>
<p>Here the events are emitted every time the specified number of events arrive. You can also specify whether to emit only the first event, last event, or all events out of the events that arrived.</p>
<p>In this example, the last temperature per sensor is emitted for every 10 events.</p>
<p><pre>
from TempStreamselect 
select temp, deviceID
group by deviceID
output last every 10 events
insert into LowRateTempStream;    </pre></p>
</li>
<li>
<p>Emitting events based on time</p>
<p>Here events are emitted for every predefined time interval. You can also specify whether to to emit only the first event, last event, or all events out of the events that arrived during the specified time interval.</p>
<p>In this example, emits all temperature events every 10 seconds  </p>
<p><pre>
from TempStreamoutput 
output every 10 sec
insert into LowRateTempStream;    </pre></p>
</li>
<li>
<p>Emitting a periodic snapshot of events</p>
<p>This method works best with windows. When an input stream is connected to a window, snapshot rate limiting emits all the current events that have arrived and do not have corresponding expired events for every predefined time interval. 
If the input stream is not connected to a window, only the last current event for each predefined time interval is emitted.</p>
<p>The following query emits snapshot of the events in a time window of 5 seconds every 1 second. </p>
<p><pre>
from TempStream#window.time(5 sec)
output snapshot every 1 sec
insert into SnapshotTempStream;    </pre></p>
</li>
</ul>
<h2 id="partition">Partition<a class="headerlink" href="#partition" title="Permanent link">&para;</a></h2>
<p>Partitions divides streams and queries into isolated groups to process them in parallel and in isolation. 
A partition can contain one or more queries and there will be multiple instances of the same queries and streams replicated for each partition. 
Each partition is tagged with a partition key those partitions only process the events that matches the corresponding partition key. </p>
<p><strong>Purpose</strong> </p>
<p>Partition let you process the events groups in isolation such that event processing can be performed using the same set of queries for each group. </p>
<p><strong>Partition key generation</strong></p>
<p>Partition key can be generation in two ways. </p>
<ul>
<li>
<p>Partition by value</p>
<p>This is created by generating unique values using input stream attributes.</p>
<p><strong>Syntax</strong></p>
<p><pre>
partition with ( &lt;expression&gt; of &lt;stream name&gt;, &lt;expression&gt; of &lt;stream name&gt;, ... )
begin
    &lt;query&gt;
    &lt;query&gt;
    ...
end; </pre></p>
<p><strong>Example</strong></p>
<p>The following query calculates the maximum temperature recorded within the last 10 events per <code>deviceID</code>.</p>
<p><pre>
partition with ( deviceID of TempStream )
begin
    from TempStream#window.length(10)
    select roomNo, deviceID, max(temp) as maxTemp
    insert into DeviceTempStream;
end;
</pre></p>
</li>
<li>
<p>Partition by range</p>
<p>This is created by mapping each partition key to a range condition of the input stream's numerical attribute.</p>
<p><strong>Syntax</strong></p>
<p><pre>
partition with ( &lt;condition&gt; as &lt;partition key&gt; or &lt;condition&gt; as &lt;partition key&gt; or ... of &lt;stream name&gt;, ... )
begin
    &lt;query&gt;
    &lt;query&gt;
    ...
end;
</pre></p>
<p><strong>Example</strong></p>
<p>The following query calculates the average temperature for the last 10 minutes per office area.</p>
<p><pre>
partition with ( roomNo &gt;= 1030 as 'serverRoom' or 
                 roomNo &lt; 1030 and roomNo &gt;= 330 as 'officeRoom' or 
                 roomNo &lt; 330 as 'lobby' of TempStream)
begin
    from TempStream#window.time(10 min)
    select roomNo, deviceID, avg(temp) as avgTemp
    insert into AreaTempStream
end;
</pre>  </p>
</li>
</ul>
<h3 id="inner-stream">Inner Stream<a class="headerlink" href="#inner-stream" title="Permanent link">&para;</a></h3>
<p>Queries inside a partition block can use inner streams to communicate between each other while preserving partition isolation.
Inner streams are denoted by a "#" in front of them, and these streams cannot be accessed outside of the partition block. </p>
<p><strong>Purpose</strong></p>
<p>Inner streams let you connect queries within the partition block such that output of a query will only feed to a query 
that's in the same partition. With this you don't need to repartition the streams if they are communicating within the partition.</p>
<p><strong>Example</strong></p>
<p>For each sensor, following partition calculates the average temperature over every 10 events
and produces output to <code>DeviceTempIncreasingStream</code> is the consecutive average temperature values are increasing more then 
5 degrees.</p>
<pre>
partition with ( deviceID of TempStream )
begin
    from TempStream#window.lengthBatch(10)
    select roomNo, deviceID, avg(temp) as avgTemp
    insert into #AvgTempStream

    from every (e1=#AvgTempStream),e2=#AvgTempStream[e1.avgTemp + 5 < avgTemp]
    select e1.deviceID, e1.avgTemp as initialAvgTemp, e2.avgTemp as finalAvgTemp
    insert into DeviceTempIncreasingStream
end;
</pre>

<h2 id="table">Table<a class="headerlink" href="#table" title="Permanent link">&para;</a></h2>
<p>A table is a stored version of an stream or a table of events. It's schema is defined via the <strong>table definition</strong> thats
quite similar to a stream definition. These events are by default stored 
<code>in-memory</code> but Siddhi also provides store extension to work with data/events stored in various data stores through the 
table abstraction.</p>
<p><strong>Purpose</strong></p>
<p>Tables allow Siddhi to work with stored events. By defining a schema to table Siddhi enables them to be processed at queries using their defined attributes with the streaming data, and also interactively query the state of the stored events in the table.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for defining a new table.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="o">&lt;</span><span class="n">stream</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">);</span>
</pre></div>


<p>The following parameters are configured in a table definition.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>table name</code></td>
<td>The name of the table defined. (as a convention <code>PascalCase</code> is used for table name)</td>
</tr>
<tr>
<td><code>attribute name</code></td>
<td>The schema of the table is defined by its attributes by uniquely identifiable attribute names (as a convention <code>camalCase</code> is used for attribute names)</td>
</tr>
<tr>
<td><code>attribute type</code></td>
<td>The type of each attribute defined in the schema. <br/> This can be <code>STRING</code>, <code>INT</code>, <code>LONG</code>, <code>DOUBLE</code>, <code>FLOAT</code>, <code>BOOL</code> or <code>OBJECT</code>.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>Defining a table named <code>RoomTypeTable</code> with the attributes <code>roomNo</code> with type <code>int</code>, and <code>type</code> with type <code>string</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span> <span class="p">);</span>
</pre></div>


<p><strong>Primary Keys</strong></p>
<p>Tables can be configured with primary keys to avoid the duplication of data. </p>
<p>Primary keys are configured by including the <code>@PrimaryKey( 'key1', 'key2' )</code> annotation to the table definition. 
Each event table configuration can have only one <code>@PrimaryKey</code> annotation. 
The number of attributes supported differ based on the table implementations and when more then one attribute 
 is used for primary key the combination of the keys will be used to grantee uniqueness among the events saved in the table.</p>
<p><strong>Examples</strong></p>
<p>The following query creates an event table with the <code>symbol</code> attribute as the primary key. 
Therefore each entry in this table will have a unique value for <code>symbol</code> attribute.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">PrimaryKey</span><span class="p">(</span><span class="s1">&#39;symbol&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">StockTable</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">price</span> <span class="nb">float</span><span class="p">,</span> <span class="n">volume</span> <span class="n">long</span><span class="p">);</span>
</pre></div>


<p><strong>Indexes</strong></p>
<p>Indexes let tables to searched/modified much faster. </p>
<p>Indexes are configured by including the <code>@Index( 'key1', 'key2' )</code> annotation to the table definition.
 Each event table configuration can have at most only one <code>@Index</code> annotation. 
 Support for <code>@Index</code> annotation and the number of attributes supported differ based on the table implementations. 
 When more then one attribute used for index each of them will be used to index the table for fast access of the data. 
 Indexes can be configured together with primary keys. </p>
<p><strong>Examples</strong></p>
<p>The following query creates an indexed event table named <code>RoomTypeTable</code> using attribute <code>roomNo</code> as the index key.</p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="k">Index</span><span class="p">(</span><span class="s1">&#39;roomNo&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
</pre></div>


<p><strong>Operators on Table</strong></p>
<p>The following operators can be performed on tables.</p>
<h3 id="insert">Insert<a class="headerlink" href="#insert" title="Permanent link">&para;</a></h3>
<p>This allows events to be inserted in to tables. This is similar to inserting events into streams. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the table is defined with primary keys, and if you insert duplicate data primary key constrain violation can occur. 
In such cases use the <code>update or insert</code> operation. </p>
</div>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span>
</pre></div>


<p>Like in streams to insert only the specific output event types, use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword between <code>insert</code> and <code>into</code> keywords. 
For more information refer <a href="http://127.0.0.1:8000/documentation/siddhi-4.0/#output-event-types">output event type</a> section.</p>
<p><strong>Example</strong></p>
<p>The following query inserts all events from the <code>TempStream</code> stream to the <code>TempTable</code> table.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">TempTable</span><span class="p">;</span>
</pre></div>


<h3 id="join-table">Join (Table)<a class="headerlink" href="#join-table" title="Permanent link">&para;</a></h3>
<p>To allow a stream to retrieve information from a table in a streaming manner.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Join can also be performed with <a href="#join-stream">two streams</a>, <a href="#join-aggregation">aggregation</a> or against externally <a href="#join-window">defined windows</a>.</p>
</div>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> <span class="k">join</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;|&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="p">).</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;|&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="p">).</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table can only be joint with a stream, and two tables cannot be joined because there should be at least one active 
entity to trigger the join operation.</p>
</div>
<p><strong>Example</strong></p>
<p>The following Siddhi App performs a join to retrieve the room type from <code>RoomTypeTable</code> table based on the room number, such that it can filter the events related to <code>server-room</code>s.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span> <span class="k">join</span> <span class="n">RoomTypeTable</span>
    <span class="k">on</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">TempStream</span><span class="p">.</span><span class="n">roomNo</span>
<span class="k">select</span> <span class="n">deviceID</span><span class="p">,</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="k">type</span> <span class="k">as</span> <span class="n">roomType</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">temp</span>
    <span class="k">having</span> <span class="n">roomType</span> <span class="o">==</span> <span class="s1">&#39;server-room&#39;</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">ServerRoomTempStream</span><span class="p">;</span>
</pre></div>


<h3 id="delete">Delete<a class="headerlink" href="#delete" title="Permanent link">&para;</a></h3>
<p>To delete selected events that are stored in a table.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">delete</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span> <span class="p">(</span><span class="k">for</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">event</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">)</span><span class="o">?</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
</pre></div>


<p>The <code>condition</code> element specifies the basis on which events are selected to be deleted. 
When specifying the condition, table attributes should be referred to with the table name.</p>
<p>To execute delete for specific output event types use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword with <code>for</code> as shown
in the syntax. To understand more refer <a href="http://127.0.0.1:8000/documentation/siddhi-4.0/#output-event-types">output event type</a> section.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table attributes should be always referred to with the table name as <code>&lt;table name&gt;.&lt;attibute name&gt;</code>.</p>
</div>
<p><strong>Example</strong></p>
<p>The following script deletes entries from the <code>RoomTypeTable</code> table, 
that have room number equal to the <code>roomNumber</code> attribute of the events in <code>DeleteStream</code> stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomTypeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">);</span>

<span class="n">define</span> <span class="n">stream</span> <span class="n">DeleteStream</span> <span class="p">(</span><span class="n">roomNumber</span> <span class="nb">int</span><span class="p">);</span>

<span class="k">from</span> <span class="n">DeleteStream</span>
<span class="k">delete</span> <span class="n">RoomTypeTable</span>
    <span class="k">on</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNumber</span><span class="p">;</span>
</pre></div>


<h3 id="update">Update<a class="headerlink" href="#update" title="Permanent link">&para;</a></h3>
<p>Update selected event attributes stored in a table based on a condition. </p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">update</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span> <span class="p">(</span><span class="k">for</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">event</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">)</span><span class="o">?</span> 
    <span class="k">set</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
</pre></div>


<p>The <code>condition</code> element specifies the basis on which events are selected for update.
When specifying the <code>condition</code>, table attributes should be referred to with the table name.</p>
<p>Use <code>set</code> keyword to update selected attributes from the table. Here for each assignment the left hand side 
 attribute should be a table attribute and the right hand side attribute can be stream/table attribute, mathematical 
 operations or other. When <code>set</code> clause is not provided all attributes in the table will be updated.  </p>
<p>To execute update upon specific output event types use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword with <code>for</code> as shown
in the syntax. To understand more refer <a href="http://127.0.0.1:8000/documentation/siddhi-4.0/#output-event-types">output event type</a> section.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table attributes should be always referred to with the table name as <code>&lt;table name&gt;.&lt;attibute name&gt;</code>.</p>
</div>
<p><strong>Example</strong></p>
<p>Siddhi app updating room occupancy in the <code>RoomOccupancyTable</code> table for each room number based on new arrival and exit from the <code>UpdateStream</code> stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomOccupancyTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">people</span> <span class="nb">int</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">UpdateStream</span> <span class="p">(</span><span class="n">roomNumber</span> <span class="nb">int</span><span class="p">,</span> <span class="n">arrival</span> <span class="nb">int</span><span class="p">,</span> <span class="n">exit</span> <span class="nb">int</span><span class="p">);</span>

<span class="k">from</span> <span class="n">UpdateStream</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">update</span> <span class="n">RoomTypeTable</span>
    <span class="k">set</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="n">people</span> <span class="o">=</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="n">people</span> <span class="o">+</span> <span class="n">arrival</span> <span class="o">-</span> <span class="n">exit</span>
    <span class="k">on</span> <span class="n">RoomTypeTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNumber</span><span class="p">;</span>
</pre></div>


<h3 id="update-or-insert">Update or Insert<a class="headerlink" href="#update-or-insert" title="Permanent link">&para;</a></h3>
<p>Let you update if the event attributes already exist in the table based on a condition, or 
else insert the entry as a new attribute.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">update</span> <span class="k">or</span> <span class="k">insert</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span> <span class="p">(</span><span class="k">for</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">event</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">)</span><span class="o">?</span> 
    <span class="k">set</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="p">.</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
</pre></div>


<p>The <code>condition</code> element specifies the basis on which events are selected for update.
When specifying the <code>condition</code>, table attributes should be referred to with the table name. 
Here if no stored event matches for the given condition then the arriving event will be inserting into 
the table.</p>
<p>The <code>set</code> clause is only used when the update operation is performed and it will during the insert operation. 
When ing the <code>set</code> clause assignments their the left hand side attribute should be always a table attribute and 
the right hand side attribute can be stream/table attribute, mathematical 
 operations or other. When <code>set</code> clause is not provided all attributes in the table will be updated.  </p>
<p>To execute update upon specific output event types use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword with <code>for</code> as shown
in the syntax. To understand more refer <a href="http://127.0.0.1:8000/documentation/siddhi-4.0/#output-event-types">output event type</a> section.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Table attributes should be always referred to with the table name as <code>&lt;table name&gt;.&lt;attibute name&gt;</code>.</p>
</div>
<p><strong>Example</strong></p>
<p>The following query update for events in the <code>UpdateTable</code> event table that have room numbers that match the same in the <code>UpdateStream</code> stream. When such events are founding the event table, they are updated. When a room number available in the stream is not found in the event table, it is inserted from the stream.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">RoomAssigneeTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">,</span> <span class="n">assignee</span> <span class="n">string</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RoomAssigneeStream</span> <span class="p">(</span><span class="n">roomNumber</span> <span class="nb">int</span><span class="p">,</span> <span class="k">type</span> <span class="n">string</span><span class="p">,</span> <span class="n">assignee</span> <span class="n">string</span><span class="p">);</span>

<span class="k">from</span> <span class="n">RoomAssigneeStream</span>
<span class="k">select</span> <span class="n">roomNumber</span> <span class="k">as</span> <span class="n">roomNo</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">assignee</span>
<span class="k">update</span> <span class="k">or</span> <span class="k">insert</span> <span class="n">RoomAssigneeTable</span>
    <span class="k">set</span> <span class="n">RoomAssigneeTable</span><span class="p">.</span><span class="n">assignee</span> <span class="o">=</span> <span class="n">assignee</span>
    <span class="k">on</span> <span class="n">RoomAssigneeTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNo</span><span class="p">;</span>
</pre></div>


<h3 id="in">In<a class="headerlink" href="#in" title="Permanent link">&para;</a></h3>
<p>Let the stream check if the expected value exist in the table as part of a conditional operation.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span> <span class="k">in</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span><span class="p">]</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<p>The <code>condition</code> element specifies the basis on which events are selected to be compared. 
When constructing the <code>condition</code>, the table attribute should be always referred to with the table name as 
<code>&lt;table&gt;.&lt;attibute name&gt;</code>.</p>
<p><strong>Example</strong></p>
<p>The Siddhi App to filter only room numbers that are listed in the <code>ServerRoomTable</code> table.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">table</span> <span class="n">ServerRoomTable</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span> <span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span><span class="p">[</span><span class="n">ServerRoomTable</span><span class="p">.</span><span class="n">roomNo</span> <span class="o">==</span> <span class="n">roomNo</span> <span class="k">in</span> <span class="n">ServerRoomTable</span><span class="p">]</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">ServerRoomTempStream</span><span class="p">;</span>
</pre></div>


<h2 id="incremental-aggregation">Incremental Aggregation<a class="headerlink" href="#incremental-aggregation" title="Permanent link">&para;</a></h2>
<p>Incremental aggregation let you obtaining aggregates in an incremental manner for a specified set of time periods.</p>
<p>This not only let you calculate aggregations with varies time granularity but also let you access them in an interactive
 manner for reports, dashboards, and for further processing. It's schema is defined via the <strong>aggregation definition</strong>.</p>
<p><strong>Purpose</strong></p>
<p>Incremental aggregation allows you to retrieve the aggregate value for different time durations. 
That is, it allows you to obtain aggregates such as <code>sum</code>, <code>count</code>, <code>avg</code>, <code>min</code>, <code>max</code>, and <code>count</code>) 
of stream attributes for durations such as <code>sec</code>, <code>min</code>, <code>hour</code>, etc. </p>
<p>This is of considerable importance in many analytics scenarios since aggregate values are often needed for several time periods. 
Furthermore, this ensures that the aggregations are not lost due to unexpected system failures, as the aggregates can be stored in different persistence <code>stores</code>.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">store</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="ss">&quot;&lt;store type&gt;&quot;</span><span class="p">,</span> <span class="p">...)</span>
<span class="n">define</span> <span class="n">aggregation</span> <span class="o">&lt;</span><span class="n">aggregator</span> <span class="n">name</span><span class="o">&gt;</span>
<span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">aggregate</span> <span class="k">function</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
    <span class="k">group</span> <span class="k">by</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span>
    <span class="k">aggregate</span> <span class="k">by</span> <span class="o">&lt;</span><span class="k">timestamp</span> <span class="n">attribute</span><span class="o">&gt;</span> <span class="k">every</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">periods</span><span class="o">&gt;</span> <span class="p">;</span>
</pre></div>


<p>The above syntax includes the following:</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@store</code></td>
<td>This annotation is used to refer to the data store where the calculated <br/>aggregate results will be stored. This annotation is optional and when <br/>no annotation is provided the data will be sored in the <code>in-memory</code> store.</td>
</tr>
<tr>
<td><code>&lt;aggregator name&gt;</code></td>
<td>Specifies a unique name for the aggregation such that it can be referred <br/>when accessing aggregate results.</td>
</tr>
<tr>
<td><code>&lt;input stream&gt;</code></td>
<td>The stream that feeds the aggregation. <strong>Note! this stream should be <br/>already defined.</strong></td>
</tr>
<tr>
<td><code>group by &lt;attribute name&gt;</code></td>
<td>The <code>group by</code> clause is optional. If it's given the aggregate values <br/>would be calculated, per each <code>group by</code> attribute, and otherwise all the<br/> events would be aggregated together.</td>
</tr>
<tr>
<td><code>by &lt;timestamp attribute&gt;</code></td>
<td>This clause is optional. This defined the attribute that should be used as<br/> the timestamp if this is not provided the event time will be used by default.<br/> The timestamp could be given as either a string or long value. If it's a <code>long</code>,<br/> the unix timestamp in milliseconds is expected (e.g. <code>1496289950000</code>). If it's <br/>a <code>string</code> the supported formats are <code>&lt;yyyy&gt;-&lt;MM&gt;-&lt;dd&gt; &lt;HH&gt;:&lt;mm&gt;:&lt;ss&gt;</code> <br/>(if time is in GMT) and  <code>&lt;yyyy&gt;-&lt;MM&gt;-&lt;dd&gt; &lt;HH&gt;:&lt;mm&gt;:&lt;ss&gt; &lt;Z&gt;</code> (if time is <br/>not in GMT), here the ISO 8601 UTC offset must be provided for <code>&lt;Z&gt;</code> <br/>(ex. <code>+05:30</code>, <code>-11:00</code>).</td>
</tr>
<tr>
<td><code>&lt;time periods&gt;</code></td>
<td>This depicts the aggregation period. This can be defined either as a range <br/>such as <code>evey sec ... year</code> defining that it should process all time <br/>granularities form second to year, or as comma separated values such as <br/> <code>every sec, hour, month</code>. Aggregation supports <code>second</code>, <code>minute</code>, <code>hour</code>, <br/><code>day</code>, <code>month</code> and <code>year</code> as its time granularity levels.</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong></p>
<p>Siddhi App defining <code>TradeAggregation</code> to calculate  average and sum of <code>price</code> from <code>TradeStream</code> stream every second to year time granularities.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">TradeStream</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">price</span> <span class="n">double</span><span class="p">,</span> <span class="n">volume</span> <span class="n">long</span><span class="p">,</span> <span class="k">timestamp</span> <span class="n">long</span><span class="p">);</span>

<span class="n">define</span> <span class="n">aggregation</span> <span class="n">TradeAggregation</span>
  <span class="k">from</span> <span class="n">TradeStream</span>
  <span class="k">select</span> <span class="n">symbol</span><span class="p">,</span> <span class="k">avg</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">as</span> <span class="n">avgPrice</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">as</span> <span class="n">total</span>
    <span class="k">group</span> <span class="k">by</span> <span class="n">symbol</span>
    <span class="k">aggregate</span> <span class="k">by</span> <span class="k">timestamp</span> <span class="k">every</span> <span class="n">sec</span> <span class="p">...</span> <span class="k">year</span><span class="p">;</span>
</pre></div>


<h3 id="join-aggregation">Join (Aggregation)<a class="headerlink" href="#join-aggregation" title="Permanent link">&para;</a></h3>
<p>Join allow a stream to retrieve calculated aggregate values from the aggregation. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Join can also be performed with <a href="#join-stream">two streams</a>, with <a href="#join-table">table</a> or against externally <a href="#join-window">defined windows</a>.</p>
</div>
<p><strong>Syntax</strong></p>
<p>Join with aggregation is similer to the join with <a href="#join-table">table</a>, but with additional <code>within</code> and <code>per</code> clauses. </p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> <span class="k">join</span> <span class="o">&lt;</span><span class="n">aggrigation</span><span class="o">&gt;</span> 
  <span class="k">on</span> <span class="o">&lt;</span><span class="k">join</span> <span class="n">condition</span><span class="o">&gt;</span> 
  <span class="n">within</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">range</span><span class="o">&gt;</span> 
  <span class="n">per</span> <span class="o">&lt;</span><span class="n">time</span> <span class="n">granularity</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p>Apart for constructs of <a href="#join-table">table</a> this includes the following :</p>
<table>
<thead>
<tr>
<th>Item</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>within  &lt;time range&gt;</code></td>
<td>This allows you to specify the time interval for which the aggregate values need to be retrieved. This can be specified by providing the start and end time separated by comma as <code>string</code> or <code>long</code> values or by using wildcard <code>string</code> specifying the data range. For details refer examples.</td>
</tr>
<tr>
<td><code>per &lt;time granularity&gt;</code></td>
<td>This specifies the time granularity by which the aggregate values must be grouped and returned. E.g., If you specify <code>days</code>, the retrieved aggregate values are grouped for each day within the selected time interval.</td>
</tr>
</tbody>
</table>
<p><code>within</code> and <code>par</code> clauses also accept attribute values from the stream.</p>
<p><strong>Example</strong></p>
<p>Retrieving all aggregation per day within the time range <code>"2014-02-15 00:00:00 +05:30", "2014-03-16 00:00:00 +05:30"</code> </p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">StockStream</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">value</span> <span class="nb">int</span><span class="p">);</span>

<span class="k">from</span> <span class="n">StockStream</span> <span class="k">as</span> <span class="n">S</span> <span class="k">join</span> <span class="n">TradeAggregation</span> <span class="k">as</span> <span class="n">T</span>
  <span class="k">on</span> <span class="n">S</span><span class="p">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="n">T</span><span class="p">.</span><span class="n">symbol</span> 
  <span class="n">within</span> <span class="ss">&quot;2014-02-15 00:00:00 +05:30&quot;</span><span class="p">,</span> <span class="ss">&quot;2014-03-16 00:00:00 +05:30&quot;</span> 
  <span class="n">per</span> <span class="ss">&quot;days&quot;</span> 
<span class="k">select</span> <span class="n">S</span><span class="p">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="n">total</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="n">avgPrice</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">AggregateStockStream</span><span class="p">;</span>
</pre></div>


<p>Retrieving all aggregation per hour within the day <code>2014-02-15</code>  </p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">StockStream</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">value</span> <span class="nb">int</span><span class="p">);</span>

<span class="k">from</span> <span class="n">StockStream</span> <span class="k">as</span> <span class="n">S</span> <span class="k">join</span> <span class="n">TradeAggregation</span> <span class="k">as</span> <span class="n">T</span>
  <span class="k">on</span> <span class="n">S</span><span class="p">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="n">T</span><span class="p">.</span><span class="n">symbol</span> 
  <span class="n">within</span> <span class="ss">&quot;2014-02-15 **:**:** +05:30&quot;</span>
  <span class="n">per</span> <span class="ss">&quot;hours&quot;</span> 
<span class="k">select</span> <span class="n">S</span><span class="p">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="n">total</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="n">avgPrice</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">AggregateStockStream</span><span class="p">;</span>
</pre></div>


<p>Retrieving all aggregation per an attribute value from the stream and within timestamps <code>1490918400</code> and <code>1490922000</code>  </p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="n">StockStream</span> <span class="p">(</span><span class="n">symbol</span> <span class="n">string</span><span class="p">,</span> <span class="n">value</span> <span class="nb">int</span><span class="p">,</span> <span class="n">perValue</span> <span class="n">string</span><span class="p">);</span>

<span class="k">from</span> <span class="n">StockStream</span> <span class="k">as</span> <span class="n">S</span> <span class="k">join</span> <span class="n">TradeAggregation</span> <span class="k">as</span> <span class="n">T</span>
  <span class="k">on</span> <span class="n">S</span><span class="p">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="n">T</span><span class="p">.</span><span class="n">symbol</span> 
  <span class="n">within</span> <span class="mi">1490918400</span><span class="p">,</span> <span class="mi">1490922000</span>  
  <span class="n">per</span> <span class="n">S</span><span class="p">.</span><span class="n">perValue</span>
<span class="k">select</span> <span class="n">S</span><span class="p">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="n">total</span><span class="p">,</span> <span class="n">T</span><span class="p">.</span><span class="n">avgPrice</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">AggregateStockStream</span><span class="p">;</span>
</pre></div>


<h2 id="defined-window"><em>(Defined)</em> Window<a class="headerlink" href="#defined-window" title="Permanent link">&para;</a></h2>
<p>A defined window is a window that can be shared across multiple queries. 
Events can be inserted to a defined window from one or more queries and it can produce output events based on the defined window type.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for a defined window.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">window</span> <span class="o">&lt;</span><span class="n">window</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span> <span class="o">&lt;</span><span class="n">window</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="err"></span><span class="p">)</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">event</span> <span class="k">type</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>


<p>The following parameters are configured in a table definition.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>window name</code></td>
<td>The name of the window defined. (as a convention <code>PascalCase</code> is used for window name)</td>
</tr>
<tr>
<td><code>attribute name</code></td>
<td>The schema of the window is defined by its attributes by uniquely identifiable attribute names (as a convention <code>camalCase</code> is used for attribute names)</td>
</tr>
<tr>
<td><code>attribute type</code></td>
<td>The type of each attribute defined in the schema. <br/> This can be <code>STRING</code>, <code>INT</code>, <code>LONG</code>, <code>DOUBLE</code>, <code>FLOAT</code>, <code>BOOL</code> or <code>OBJECT</code>.</td>
</tr>
<tr>
<td><code>&lt;window type&gt;(&lt;parameter&gt;, ...)</code></td>
<td>The window type associated with the window and its parameters.</td>
</tr>
<tr>
<td><code>output &lt;output event type&gt;</code></td>
<td>This is optional, Keywords like <code>current events</code>, <code>expired events</code> and <code>all events</code> (the default) can be used to manipulate when the window output should be exposed. For information refer section Output event types.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Returning all output when event arrives and when events expire from the window.</p>
<p>In the following query, output event type is not specified therefore, it emits both current and expired events as the output.</p>
<p><pre>
define window SensorWindow (name string, value float, roomNo int, deviceID string) timeBatch(1 second); </pre></p>
</li>
<li>
<p>Returning a only when events  expire from the window.</p>
<p>In the following query, the window's output event type is <code>all events</code>. Therefore, it emits only the window expiry events as output.</p>
<p><pre>
define window SensorWindow (name string, value float, roomNo int, deviceID string) timeBatch(1 second) output expired events; </pre></p>
</li>
</ul>
<p><strong>Operators on Defined Windows</strong></p>
<p>The following operators can be performed on defined windows.</p>
<h3 id="insert_1">Insert<a class="headerlink" href="#insert_1" title="Permanent link">&para;</a></h3>
<p>This allows events to be inserted in to windows. This is similar to inserting events into streams. </p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="n">window</span><span class="o">&gt;</span>
</pre></div>


<p>Like in streams to insert only the specific output event types, use the <code>current events</code>, <code>expired events</code> or the <code>all events</code> keyword between <code>insert</code> and <code>into</code> keywords. 
For more information refer <a href="#output-event-types">output event type</a> section.</p>
<p><strong>Example</strong></p>
<p>The following query inserts all events from the <code>TempStream</code> stream to the <code>OneMinTempWindow</code> window.</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">TempStream</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">OneMinTempWindow</span><span class="p">;</span>
</pre></div>


<h3 id="join-window">Join (Window)<a class="headerlink" href="#join-window" title="Permanent link">&para;</a></h3>
<p>To allow a stream to retrieve information from a window based on a condition.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Join can also be performed with <a href="#join-stream">two streams</a>, <a href="#join-aggregation">aggregation</a> or with tables <a href="#join-table">tables</a>.</p>
</div>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;</span> <span class="k">join</span> <span class="o">&lt;</span><span class="n">window</span><span class="o">&gt;</span>
    <span class="k">on</span> <span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
<span class="k">select</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;|&lt;</span><span class="n">window</span><span class="o">&gt;</span><span class="p">).</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">(</span><span class="o">&lt;</span><span class="k">input</span> <span class="n">stream</span><span class="o">&gt;|&lt;</span><span class="n">window</span><span class="o">&gt;</span><span class="p">).</span><span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Example</strong></p>
<p>The following Siddhi App performs a join count the number of temperature events having more then 40 degrees 
 within the last 2 minutes. </p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">window</span> <span class="n">TwoMinTempWindow</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">)</span> <span class="n">time</span><span class="p">(</span><span class="s1">&#39;2 min&#39;</span><span class="p">);</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">CheckStream</span> <span class="p">(</span><span class="n">requestId</span> <span class="n">string</span><span class="p">);</span>

<span class="k">from</span> <span class="n">CheckStream</span> <span class="k">as</span> <span class="k">C</span> <span class="k">join</span> <span class="n">TwoMinTempWindow</span> <span class="k">as</span> <span class="n">T</span>
    <span class="k">on</span> <span class="n">T</span><span class="p">.</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">40</span>
<span class="k">select</span> <span class="n">requestId</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">T</span><span class="p">.</span><span class="n">temp</span><span class="p">)</span> <span class="k">as</span> <span class="k">count</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">HighTempCountStream</span><span class="p">;</span>
</pre></div>


<h3 id="from">From<a class="headerlink" href="#from" title="Permanent link">&para;</a></h3>
<p>A window can be also be used as input to any query like streams. </p>
<p>Note !!!
     When window is used as input to a query, another window cannot be applied on top of this.</p>
<p><strong>Syntax</strong></p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="o">&lt;</span><span class="n">window</span><span class="o">&gt;</span> 
<span class="k">select</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span>
<span class="k">insert</span> <span class="k">into</span> <span class="o">&lt;</span><span class="k">output</span> <span class="n">stream</span><span class="o">&gt;</span>
</pre></div>


<p><strong>Example</strong>
The following Siddhi App calculates the maximum temperature within last 5 minutes.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">window</span> <span class="n">FiveMinTempWindow</span> <span class="p">(</span><span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">)</span> <span class="n">time</span><span class="p">(</span><span class="s1">&#39;5 min&#39;</span><span class="p">);</span>


<span class="k">from</span> <span class="n">FiveMinTempWindow</span>
<span class="k">select</span> <span class="n">name</span><span class="p">,</span> <span class="k">max</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">as</span> <span class="k">maxValue</span><span class="p">,</span> <span class="n">roomNo</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">MaxSensorReadingStream</span><span class="p">;</span>
</pre></div>


<h2 id="trigger">Trigger<a class="headerlink" href="#trigger" title="Permanent link">&para;</a></h2>
<p>Triggers allow events to be periodically generated. <strong>Trigger definition</strong> can be used to define a trigger. 
Trigger also works like a stream with a predefined schema.</p>
<p><strong>Purpose</strong></p>
<p>For some use cases the system should be able to periodically generated events based on specified time interval to perform 
some periodic executions. </p>
<p>Trigger can be performed during three times such as <code>'start'</code>, for a given <code>&lt;time interval&gt;</code> or for a given <code>'&lt;cron expression&gt;'</code>, </p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for an trigger definition.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">trigger</span> <span class="o">&lt;</span><span class="k">trigger</span> <span class="n">name</span><span class="o">&gt;</span> <span class="k">at</span> <span class="p">(</span><span class="s1">&#39;start&#39;</span><span class="o">|</span> <span class="k">every</span> <span class="o">&lt;</span><span class="n">time</span> <span class="nb">interval</span><span class="o">&gt;|</span> <span class="s1">&#39;&lt;cron expression&gt;&#39;</span><span class="p">);</span>
</pre></div>


<p>Triggers can be used as inputs like streams and they adhere to the following stream definition, and produces <code>triggered_time</code> attribute with type <code>long</code></p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="n">stream</span> <span class="o">&lt;</span><span class="k">trigger</span> <span class="n">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">triggered_time</span> <span class="n">long</span><span class="p">);</span>
</pre></div>


<p>Types of triggers supported as following</p>
<table>
<thead>
<tr>
<th>Trigger type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>'start'</code></td>
<td>An event will be trigger at Siddhi start.</td>
</tr>
<tr>
<td><code>every &lt;time interval&gt;</code></td>
<td>an event will be triggered periodically on the given time interval.</td>
</tr>
<tr>
<td><code>'&lt;cron expression&gt;'</code></td>
<td>an event will be triggered periodically based on the given cron expression, refer  <a target="_blank" href="http://www.quartz-scheduler.org/documentation/quartz-2.2.x/tutorials/tutorial-lesson-06">quartz-scheduler</a> for config details.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<ul>
<li>
<p>Triggering events regularly at specific time intervals</p>
<p>The following query triggers events every 5 minutes.</p>
<p><code>sql
 define trigger FiveMinTriggerStream at every 5 min;</code></p>
</li>
<li>
<p>Triggering events at a specific time on specified days</p>
<p>The following query triggers an event at 10.15 AM on every weekdays.</p>
<p>```sql
 define trigger FiveMinTriggerStream at '0 15 10 ? * MON-FRI';</p>
<p>```</p>
</li>
</ul>
<h2 id="script">Script<a class="headerlink" href="#script" title="Permanent link">&para;</a></h2>
<p>Script allows you to write functions in other programming languages and execute them within queries. 
Functions defined via script can be accessed in queries just like any other inbuilt functions. 
<strong>Function definitions</strong> can be used to define these scripts.</p>
<p>Function parameters are passed as <code>Object[]</code> with the name <code>data</code> into the function logic. </p>
<p><strong>Purpose</strong></p>
<p>Scripts let you define a function operation that not provided in Siddhi core or it's extension and let you define 
the function logic without focusing you to write an extension.</p>
<p><strong>Syntax</strong></p>
<p>The following is the syntax for a Script definition.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">function</span> <span class="o">&lt;</span><span class="k">function</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">[</span><span class="o">&lt;</span><span class="k">language</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">]</span> <span class="k">return</span> <span class="o">&lt;</span><span class="k">return</span> <span class="k">type</span><span class="o">&gt;</span> <span class="err">{</span>
    <span class="o">&lt;</span><span class="k">operation</span> <span class="k">of</span> <span class="n">the</span> <span class="k">function</span><span class="o">&gt;</span>
<span class="err">}</span><span class="p">;</span>
</pre></div>


<p>The following parameters are configured when defining a script.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>function name</code></td>
<td>The name of the function (as a convention <code>camalCase</code> is used for function name).</td>
</tr>
<tr>
<td><code>language name</code></td>
<td>The name of the programming language used to define the script, such as <code>javascript</code>, <code>r</code> and <code>scala</code>.</td>
</tr>
<tr>
<td><code>return type</code></td>
<td>The return attribute type of the the function. It can be <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>string</code>, <code>bool</code> or <code>object</code>. Here the function implementer should be responsible for returning the output attribute on the defined return type for proper functionality.</td>
</tr>
<tr>
<td><code>operation of the function</code></td>
<td>Here, the execution logic of the function is added. This logic should be written in the language specified under the <code>language name</code>, and it should return the output on the specified <code>return type</code> parameter.</td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<p>The following query performs concatenation using JavaScript and returns the output as a string.</p>
<div class="codehilite"><pre><span></span><span class="n">define</span> <span class="k">function</span> <span class="n">concatFn</span><span class="p">[</span><span class="n">javascript</span><span class="p">]</span> <span class="k">return</span> <span class="n">string</span> <span class="err">{</span>
    <span class="n">var</span> <span class="n">str1</span> <span class="o">=</span> <span class="k">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">var</span> <span class="n">str2</span> <span class="o">=</span> <span class="k">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">var</span> <span class="n">str3</span> <span class="o">=</span> <span class="k">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">var</span> <span class="n">responce</span> <span class="o">=</span> <span class="n">str1</span> <span class="o">+</span> <span class="n">str2</span> <span class="o">+</span> <span class="n">str3</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">responce</span><span class="p">;</span>
<span class="err">}</span><span class="p">;</span>

<span class="n">define</span> <span class="n">stream</span> <span class="n">TempStream</span><span class="p">(</span><span class="n">deviceID</span> <span class="n">long</span><span class="p">,</span> <span class="n">roomNo</span> <span class="nb">int</span><span class="p">,</span> <span class="n">temp</span> <span class="n">double</span><span class="p">);</span>

<span class="k">from</span> <span class="n">TempStream</span>
<span class="k">select</span> <span class="n">concatFn</span><span class="p">(</span><span class="n">roomNo</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">deviceID</span><span class="p">)</span> <span class="k">as</span> <span class="n">id</span><span class="p">,</span> <span class="n">temp</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">DeviceTempStream</span><span class="p">;</span>
</pre></div>


<h2 id="extensions">Extensions<a class="headerlink" href="#extensions" title="Permanent link">&para;</a></h2>
<p>Siddhi supports an extension architecture to enhance its functionality by incorporating other libraries in a seamless manner. </p>
<p><strong>Purpose</strong></p>
<p>Extensions are supported because, Siddhi core cannot have all the functionality that's needed for all the use cases, mostly use cases require 
different type of functionality, and for come cases there can be gaps and you need to write the functionality by yourself.</p>
<p>All extensions have a namespace. This is used to identify the relevant extensions together, and to let you specifically call the extension.</p>
<p><strong>Syntax</strong></p>
<p>Extensions follow the following syntax;</p>
<div class="codehilite"><pre><span></span><span class="o">&lt;</span><span class="n">namespace</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="k">function</span> <span class="n">name</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="k">parameter</span><span class="o">&gt;</span><span class="p">,</span> <span class="p">...</span> <span class="p">)</span>
</pre></div>


<p>The following parameters are configured when referring a script function.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>namespace</code></td>
<td>Allows Siddhi to identify the extension without conflict</td>
</tr>
<tr>
<td><code>function name</code></td>
<td>The name of the function referred.</td>
</tr>
<tr>
<td><code>parameter</code></td>
<td>The function input parameter for function execution.</td>
</tr>
</tbody>
</table>
<p><strong>Extension types</strong></p>
<p>Siddhi supports following extension types:</p>
<ul>
<li>
<p><strong>Function</strong></p>
<p>For each event, it consumes zero or more parameters as input parameters, and outputs a single attribute. This could be used to manipulate existing event attributes to generate new attributes like any Function operation.</p>
<p>This is implemented by extending <code>org.wso2.siddhi.core.executor.function.FunctionExecutor</code>.</p>
<p>Example : </p>
<p><code>math:sin(x)</code> here the <code>sin</code> function of <code>math</code> extension will return the sin value for parameter <code>x</code>.</p>
</li>
<li>
<p><strong>Aggregate Function</strong></p>
<p>For each event, it consumes zero or more parameters as input parameters, and outputs a single attribute having an aggregated results. This could be used with conjunction with a window in order to find the aggregated results based on the given window like any Aggregate Function operation. </p>
<p>This is implemented by extending <code>org.wso2.siddhi.core.query.selector.attribute.aggregator.AttributeAggregator</code>.</p>
<p>Example : </p>
<p><code>custom:std(x)</code> here the <code>std</code> aggregate function of <code>custom</code> extension will return the standard deviation of value <code>x</code> based on it's assigned window query. </p>
</li>
<li>
<p><strong>Window</strong> </p>
<p>Allows events to be <strong>collected, generated, dropped and expired anytime</strong> <strong>without altering</strong> the event format based on the given input parameters, like any other Window operator. </p>
<p>This is implemented by extending <code>org.wso2.siddhi.core.query.processor.stream.window.WindowProcessor</code>.</p>
<p>Example : </p>
<p><code>custom:unique(key)</code> here the <code>unique</code> window of <code>custom</code> extension will retain one event for each unique <code>key</code> parameter.</p>
</li>
<li>
<p><strong>Stream Function</strong></p>
<p>Allows events to be  <strong>generated or dropped only during event arrival</strong> and <strong>altered</strong> by adding one or more attributes to it. </p>
<p>This is implemented by extending  <code>org.wso2.siddhi.core.query.processor.stream.function.StreamFunctionProcessor</code>.</p>
<p>Example :  </p>
<p><code>custom:pol2cart(theta,rho)</code> here the <code>pol2cart</code> function of <code>custom</code> extension will return all events by calculating the cartesian coordinates <code>x</code> &amp; <code>y</code> and adding them as new attributes to the events.</p>
</li>
<li>
<p><strong>Stream Processor</strong></p>
<p>Allows events to be <strong>collected, generated, dropped and expired anytime</strong> with <strong>altering</strong> the event format by adding one or more attributes to it based on the given input parameters. </p>
<p>Implemented by extending "oorg.wso2.siddhi.core.query.processor.stream.StreamProcessor".</p>
<p>Example :  </p>
<p><code>custom:perMinResults(&lt;parameter&gt;, &lt;parameter&gt;, ...)</code> here the <code>perMinResults</code> function of <code>custom</code> extension will return all events by adding one or more attributes the events based on the conversion logic and emit output every minute despite of event arrivals.</p>
</li>
<li>
<p><strong>Sink</strong></p>
</li>
<li>
<p><strong>Source</strong></p>
</li>
<li>
<p><strong>Store</strong></p>
</li>
<li>
<p><strong>Script</strong></p>
</li>
</ul>
<p><strong>Example</strong></p>
<p>A window extension created with namespace <code>foo</code> and function name <code>unique</code> can be referred as follows:</p>
<div class="codehilite"><pre><span></span><span class="k">from</span> <span class="n">StockExchangeStream</span><span class="p">[</span><span class="n">price</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">foo</span><span class="p">:</span><span class="k">unique</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<span class="k">select</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">price</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">StockQuote</span>
</pre></div>


<p><strong>Available Extensions</strong></p>
<p>Siddhi currently have several pre written extensions <a target="_blank" href="https://wso2.github.io/siddhi/extensions/">here</a></p>
<p><em>We value your contribution on improving Siddhi and its extensions further.</em></p>
<p><strong>Writing Custom Extensions</strong></p>
<p>Custom extensions can be written in order to cater use case specific logic that are not out of the box available in Siddhi or as an existing extension. </p>
<p>More information on this will be available soon.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../user-guide/" title="User Guide" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                User Guide
              </span>
            </div>
          </a>
        
        
          <a href="../../extensions/" title="Extensions" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Extensions
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2011 - 2017 WSO2
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/wso2/siddhi" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.linkedin.com/groups/13553064" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-6b599127bc.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
      <script>!function(e,t,a,n,o,c,i){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,c=t.createElement(a),i=t.getElementsByTagName(a)[0],c.async=1,c.src=n,i.parentNode.insertBefore(c,i)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-103065-28","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var t=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",t,e.href)})});var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})</script>
      
    
  </body>
</html>